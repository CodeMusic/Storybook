(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[162],{2818:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Storyforge",function(){return a(7815)}])},2779:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});let l=(0,a(1134).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},5062:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});let l=(0,a(1134).Z)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]])},7326:function(e,t,a){"use strict";a.d(t,{T:function(){return n}});var l=a(5893),r=a(7294),s=a(9346);function n(e){let{coverUrl:t,title:a,onBroken:n}=e,[i,c]=(0,r.useState)(!1);return(0,l.jsxs)(s.Zb,{className:"bg-amber-50/80 border-amber-300 overflow-hidden",children:[t&&(0,l.jsx)("img",{src:t,alt:"Cover",className:"w-full aspect-[4/3] object-cover",onError:function(){if(!i){c(!0);try{n&&n()}catch(e){}}}}),(0,l.jsx)(s.Ol,{children:(0,l.jsx)(s.ll,{className:"text-amber-950",children:"StoryForge"})}),(0,l.jsxs)(s.aY,{className:"text-sm",children:[(0,l.jsx)("div",{className:"text-amber-900/70 uppercase text-xs",children:"Title"}),(0,l.jsx)("div",{className:"font-serif text-lg",children:a})]})]})}},9346:function(e,t,a){"use strict";a.d(t,{Ol:function(){return s},Zb:function(){return r},aY:function(){return i},ll:function(){return n}});var l=a(5893);a(7294);let r=e=>{let{className:t="",...a}=e;return(0,l.jsx)("div",{className:"rounded-2xl border bg-white ".concat(t),...a})},s=e=>{let{className:t="",...a}=e;return(0,l.jsx)("div",{className:"px-4 py-3 border-b ".concat(t),...a})},n=e=>{let{className:t="",...a}=e;return(0,l.jsx)("div",{className:"text-lg font-semibold ".concat(t),...a})},i=e=>{let{className:t="",...a}=e;return(0,l.jsx)("div",{className:"px-4 py-3 ".concat(t),...a})}},8914:function(e,t,a){"use strict";function l(e){let t=[{label:"1-3",min:1,max:3},{label:"4-8",min:4,max:8},{label:"6-8",min:6,max:8},{label:"9-15",min:9,max:15},{label:"16-20",min:16,max:20},{label:"21-25",min:21,max:25},{label:"25+",min:25,max:Number.POSITIVE_INFINITY,isPlus:!0}];function a(e){if(isNaN(e)||e<=0)return"6-8";if(e>=25)return"25+";let a=null;for(let l of t){if(l.isPlus)continue;let t=Math.abs((l.min+l.max)/2-e);(!a||t<a.distance)&&(a={label:l.label,distance:t})}return a?a.label:"6-8"}if(!e||"string"!=typeof e)return"6-8";let l=e.toString().trim();if(!l)return"6-8";if(t.some(e=>e.label===l))return l;let r=l.toLowerCase();if(/(toddler|infant|baby)/.test(r))return"1-3";if(/(kid|child|children|elementary|grade school)/.test(r))return"6-8";if(/(teen|pre-?teen|middle school)/.test(r))return"16-20";if(/(adult|grown|mature)/.test(r))return"21-25";let s=r.match(/\b(\d{1,3})\s*\+\b/);if(s){let e=parseInt(s[1],10);if(!isNaN(e))return e>=25?"25+":a(e)}let n=r.match(/\b(\d{1,3})\s*(?:[-–—]|to|through|–)\s*(\d{1,3})\b/);if(n){let e=parseInt(n[1],10),t=parseInt(n[2],10);if(!isNaN(e)&&!isNaN(t))return function(e,t){let l=Math.min(e,t),r=Math.max(e,t);return isNaN(l)||isNaN(r)||l<=0?"6-8":r>=25?"25+":a((l+r)/2)}(e,t)}let i=r.match(/\b(\d{1,3})\b/);if(i){let e=parseInt(i[1],10);if(!isNaN(e))return a(e)}return"6-8"}function r(e){let t=l(e);if(/^\d{1,3}\+$/.test(t)){let e=parseInt(t.replace(/\D/g,""),10);return{ageMin:isNaN(e)?void 0:e,ageMax:void 0}}let a=t.match(/^(\d{1,3})-(\d{1,3})$/);if(a){let e=parseInt(a[1],10),t=parseInt(a[2],10);return{ageMin:isNaN(e)?void 0:e,ageMax:isNaN(t)?void 0:t}}return{}}function s(e){let{ageMin:t,ageMax:a}=r(e);return function(e,t){if(void 0!==e&&void 0!==t){if(t<=3)return{range:[50,150],label:"1–3"};if(e>=4&&t<=8)return{range:[500,1e3],label:"4–8"};if(e>=9&&t<=15)return{range:[1500,3e3],label:"9–15"};if(e>=16&&t<=20)return{range:[2500,4e3],label:"16–20"};if(e>=21&&t<=25)return{range:[3e3,5e3],label:"21–25"};if(e>=26||t>=26)return{range:[3e3,6e3],label:"25+"}}return{range:[3e3,5e3],label:"default-adult"}}(t,a)}function n(e){let{ageMin:t,ageMax:a}=r(e);return void 0!==a&&a<=3?"prose-xl md:prose-2xl":"prose-lg md:prose-xl"}function i(e){let{ageMin:t,ageMax:a}=r(e);return void 0!==a&&a<=3?"text-2xl md:text-3xl":"text-xl md:text-2xl"}a.d(t,{BU:function(){return s},FY:function(){return n},RH:function(){return l},VV:function(){return i}})},1207:function(e,t,a){"use strict";function l(e){let t=e.replace(/```[\s\S]*?```/g,"").replace(/\*\*(.*?)\*\*/g,"$1").split(/\r?\n/).map(e=>e.trim()).filter(Boolean),a=[],l=1;function r(e,t){let r=e.replace(/^#{1,6}\s+/,"").trim(),s=(r=r.replace(/^(?:Chapter|Ch\.?|C)\s*\d+\s*[:.\-]\s*/i,"").trim())||"Chapter ".concat(l),n=(t||"").trim()||void 0;a.push({id:l++,heading:s,synopsis:n})}for(let e=0;e<t.length;e++){let a=t[e],l=a.match(/^\s*(?:\d+[\).]|[•\-*]|\d+\s+)\s*(.*)$/);if(l){let e=l[1].trim().split(/[—–\-:]\s+/);r((e[0]||"").replace(/^(?:Chapter|Ch\.?|C)\s*\d+\s*[:.\-]\s*/i,"").trim(),(e.slice(1).join(" - ")||"").trim());continue}let s=a.match(/^#{1,6}\s+(.*)$/);if(s){if(/table of contents/i.test(s[1]))continue;let a=t[e+1],l=a&&!/^#{1,6}\s+/.test(a)&&!/^\s*(?:\d+[\).]|[•\-*])\s+/.test(a);r(s[1],l?a:void 0),l&&e++;continue}let n=a.match(/^(?:Chapter|Ch\.?|C)\s*\d+\s*[:.\-]\s*(.*)$/i);if(n){let a=t[e+1],l=a&&!/^(?:Chapter|Ch\.?|C)\s*\d+\s*[:.\-]\s*/i.test(a)&&!/^#{1,6}\s+/.test(a)&&!/^\s*(?:\d+[\).]|[•\-*])\s+/.test(a);r(n[1],l?a:void 0),l&&e++;continue}}if(0===a.length){let e=t.map(e=>e.replace(/\s{2,}$/,"").trim()).filter(Boolean).filter(e=>!/^table of contents$/i.test(e));if(e.length>=2)for(let t of e)r(t)}return a}function r(e,t){let a=t.split(/\r?\n/).filter(Boolean).slice(0,2).join(", ");return"".concat(e,": ").concat(a,". Cozy watercolor, soft light, storybook composition, ancient relic/tech motif.")}a.d(t,{B:function(){return l},Z:function(){return r}})},7815:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return I}});var l=a(5893),r=a(7294),s=a(1163),n=a(1891),i=a(1134);let c=(0,i.Z)("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);var o=a(7326);let d=e=>{let{variant:t="primary",className:a="",...r}=e;return(0,l.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm font-medium transition-colors disabled:opacity-60 disabled:pointer-events-none"," ").concat({primary:"bg-amber-600 text-white hover:bg-amber-700",secondary:"bg-amber-100 text-amber-900 hover:bg-amber-200",ghost:"bg-transparent hover:bg-amber-100 text-amber-900"}[t]," ").concat(a),...r})};var u=a(9346);let m=e=>{let{className:t="",...a}=e;return(0,l.jsx)("input",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400 ".concat(t),...a})},h=e=>{let{className:t="",...a}=e;return(0,l.jsx)("textarea",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400 ".concat(t),...a})},p=(0,i.Z)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),g=(0,i.Z)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),x=(0,i.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var b=a(5062);function f(e){let{state:t,actions:a}=e,{title:r,premise:s,ageRange:n,genre:i,chapterLength:c,chapters:o,keypoints:f,style:y,loading:v,status:j,error:N,baseLabel:w}=t,{setTitle:k,setPremise:S,setAgeRange:C,setGenre:R,setChapterLength:I,setChapters:M,setKeypoints:H,setStyle:L,onSeed:O,onPrime:U}=a,T=["1-3","4-8","6-8","9-15","16-20","21-25","25+"],E=T.includes(n)?T:[n,...T],Z=e=>e.replace("-","–"),F=[{value:"fantasy",label:"Fantasy"},{value:"adventure",label:"Adventure"},{value:"mystery",label:"Mystery"},{value:"sci-fi",label:"Sci‑Fi"},{value:"fairy-tale",label:"Fairy Tale"},{value:"historical",label:"Historical"},{value:"horror",label:"Horror"},{value:"humor",label:"Humor"},{value:"magical-realism",label:"Magical Realism"},{value:"mythology",label:"Mythology"},{value:"fable",label:"Fable"},{value:"superhero",label:"Superhero"},{value:"space-opera",label:"Space Opera"},{value:"cyberpunk",label:"Cyberpunk"},{value:"romance",label:"Romance"},{value:"thriller",label:"Thriller"},{value:"psychological-thriller",label:"Psychological Thriller"},{value:"suspense",label:"Suspense"},{value:"cozy-mystery",label:"Cozy Mystery"},{value:"survival",label:"Survival"},{value:"western",label:"Western"},{value:"family",label:"Family"},{value:"school-life",label:"School Life"},{value:"inspirational",label:"Inspirational"},{value:"moral-allegory",label:"Moral Allegory"},{value:"educational",label:"Educational"},{value:"time-travel",label:"Time Travel"},{value:"science",label:"Science"},{value:"nature",label:"Nature"},{value:"workplace",label:"Workplace"},{value:"war",label:"War"},{value:"crime",label:"Crime"},{value:"culinary",label:"Culinary"},{value:"noir",label:"Noir"},{value:"comedy",label:"Comedy"},{value:"parody",label:"Parody"},{value:"satire",label:"Satire"}],_=F.some(e=>e.value===i)?F:[{value:i,label:i.replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase())},...F];return(0,l.jsxs)(u.Zb,{className:"relative backdrop-blur bg-amber-100/70 border-amber-300 shadow-xl rounded-2xl",children:[(0,l.jsxs)(u.Ol,{className:"flex justify-between",children:[(0,l.jsxs)(u.ll,{className:"flex items-center gap-2 text-amber-950",children:[(0,l.jsx)(p,{className:"h-5 w-5"})," Seed the Story Codex"]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs text-amber-800/70",children:[(0,l.jsx)(g,{className:"h-4 w-4"})," Endpoint base: ",(0,l.jsx)("span",{className:"font-mono",children:w}),U&&(0,l.jsx)(d,{variant:"secondary",onClick:U,disabled:v,className:"ml-2 h-6 px-2 py-1 text-xs",children:"Retry seed info"})]})]}),(0,l.jsxs)(u.aY,{className:"grid grid-cols-1 md:grid-cols-5 gap-4 ".concat(v?"opacity-60":""),children:[(0,l.jsxs)("div",{className:"md:col-span-3 space-y-3",children:[(0,l.jsx)(m,{placeholder:"Title (optional)",value:r,onChange:e=>k(e.target.value)}),(0,l.jsx)(h,{placeholder:"Whisper your premise…",value:s,onChange:e=>S(e.target.value),rows:5})]}),(0,l.jsxs)("div",{className:"md:col-span-2 grid grid-cols-2 gap-3",children:[(0,l.jsxs)("div",{className:"col-span-2",children:[(0,l.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Age Range"}),(0,l.jsx)("select",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400",value:n,onChange:e=>C(e.target.value),children:E.map(e=>(0,l.jsx)("option",{value:e,children:Z(e)},e))})]}),(0,l.jsxs)("div",{className:"col-span-2",children:[(0,l.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Genre"}),(0,l.jsx)("select",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400",value:i,onChange:e=>R(e.target.value),children:_.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Chapter Length"}),(0,l.jsx)("select",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400",value:c,onChange:e=>I(e.target.value),children:[{value:"tiny",label:"Tiny"},{value:"short",label:"Short"},{value:"medium",label:"Medium"},{value:"long",label:"Long"}].map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Chapter Count?"}),(0,l.jsx)(m,{type:"number",min:3,max:20,value:o,onChange:e=>M(parseInt(e.target.value||"8"))})]}),(0,l.jsxs)("div",{className:"col-span-2",children:[(0,l.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Key points (optional)"}),(0,l.jsx)(h,{placeholder:"e.g., Chapter 2: the lantern goes out; Chapter 5: the map is mirrored",value:f,onChange:e=>H(e.target.value),rows:3})]}),(0,l.jsxs)("div",{className:"col-span-2",children:[(0,l.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Style Tags"}),(0,l.jsx)(m,{value:y,onChange:e=>L(e.target.value)})]}),(0,l.jsx)("div",{className:"flex items-end gap-2 col-span-2",children:(0,l.jsxs)(d,{onClick:O,disabled:v,className:"flex-1",children:[v?(0,l.jsx)(x,{className:"mr-2 h-4 w-4 animate-spin"}):(0,l.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Build Outline"]})}),N&&(0,l.jsx)("div",{className:"col-span-2 rounded-xl border border-red-300 bg-red-50 p-3 text-red-800",children:N})]})]}),v&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-2xl bg-amber-100/60 backdrop-blur-sm",children:(0,l.jsxs)("div",{className:"flex items-center gap-3 text-amber-900",children:[(0,l.jsxs)("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),(0,l.jsx)("span",{children:j||"Working… please wait"})]})})]})}let y=(0,i.Z)("StepBack",[["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["polygon",{points:"14,20 4,12 14,4",key:"ypakod"}]]);var v=a(2779);let j=(0,i.Z)("StepForward",[["line",{x1:"6",x2:"6",y1:"4",y2:"20",key:"fy8qot"}],["polygon",{points:"10,4 20,12 10,20",key:"1mc1pf"}]]),N=(0,i.Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var w=a(8914);function k(e){let{outline:t,chapters:a,scenes:r,influence:s,setInfluence:n,onNext:i,onExport:c,onPrev:o,onSceneImageBroken:m,ageRange:h}=e,p=r.length>=a.length,g=(0,w.FY)(h||"6-8"),x=(0,w.VV)(h||"6-8");return(0,l.jsxs)(u.Zb,{className:"bg-amber-50/80 border-amber-300",children:[(0,l.jsxs)(u.Ol,{className:"flex justify-between",children:[(0,l.jsx)(u.ll,{className:"text-amber-950",children:"Engraving the Chapters"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[!p&&r.length>0&&(0,l.jsxs)(d,{variant:"secondary",onClick:o,children:[(0,l.jsx)(y,{className:"mr-2 h-4 w-4"})," Back"]}),p?(0,l.jsxs)(d,{onClick:c,children:[(0,l.jsx)(v.Z,{className:"mr-2 h-4 w-4"})," Export Book"]}):(0,l.jsxs)(d,{onClick:i,children:[(0,l.jsx)(j,{className:"mr-2 h-4 w-4"})," Read Next Chapter"]})]})]}),(0,l.jsxs)(u.aY,{className:"space-y-6",children:[(0,l.jsx)("ol",{className:"space-y-2",children:a.map((e,t)=>{let a=t<r.length,s=t===r.length&&!p;return(0,l.jsxs)("li",{className:"rounded-xl border p-3 ".concat(a?"border-emerald-300 bg-emerald-50/60":"border-amber-200 bg-white/60"),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"font-serif font-semibold",children:[e.id,". ",e.heading]}),(0,l.jsx)("div",{className:"text-xs flex items-center gap-1",children:a?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(N,{className:"h-4 w-4 text-emerald-600"})," Engraved"]}):s?(0,l.jsx)(l.Fragment,{children:"…etching"}):(0,l.jsx)(l.Fragment,{children:"pending"})})]}),e.synopsis&&(0,l.jsx)("div",{className:"text-sm text-amber-900/80",children:e.synopsis})]},e.id)})}),r.length>0&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"text-amber-900/70 uppercase text-xs",children:"Story so far"}),r.map((e,t)=>{var a;return(0,l.jsxs)("div",{className:"rounded-2xl border border-amber-200 bg-white/70 p-4",children:[(0,l.jsx)("div",{className:"font-serif ".concat(x," mb-2 whitespace-normal break-words"),children:(()=>{let t=function(e){if(!e||!e.trim())return null;let t=e.toString(),a=t.match(/^\s*(?:<div[^>]*class=\"[^\"]*words-flash[^\"]*\"[^>]*>\s*)?(?:<h[1-6][^>]*>|<p[^>]*>)\s*Chapter\s+[^:]{1,80}:\s*([^<\n]{1,160})/i);if(a&&a[1])return a[1].trim();let l=t.match(/^\s*Chapter\s+[^:]{1,80}:\s*([^\n<]{1,160})/i);return l&&l[1]?l[1].trim():null}(e.html),a=e.chapterHeading||"";return t&&t.trim()?(0,l.jsxs)(l.Fragment,{children:["Chapter ",e.chapterId,": ",t]}):/^\s*chapter\s+/i.test(a)?(0,l.jsx)(l.Fragment,{children:a}):(0,l.jsxs)(l.Fragment,{children:["Chapter ",e.chapterId,": ",a]})})()}),e.imageUrl&&(0,l.jsx)("img",{src:e.imageUrl,alt:"Scene",className:"w-full h-auto rounded-lg border border-amber-200 mb-3",onError:()=>m&&m(t)}),(0,l.jsx)("div",{className:"".concat(g," prose-amber max-w-none"),dangerouslySetInnerHTML:{__html:function(e){if(!e||!e.trim())return e;let t=e.replace(/^\s*((?:<div[^>]*class=\"[^\"]*words-flash[^\"]*\"[^>]*>\s*)?(?:<p[^>]*>\s*)?)\s*Chapter\s+[^:]{1,80}:\s*/i,(e,t)=>"".concat(t));return t!==e?t:e.replace(/^\s*Chapter\s+[^:]{1,80}:\s*/i,"")}((a=e.html)&&a.trim()?a.replace(/^\s*((?:<div[^>]*class=\"[^\"]*words-flash[^\"]*\"[^>]*>\s*)?)(<h[1-6][^>]*>[\s\S]*?<\/h[1-6]>\s*)/i,(e,t)=>"".concat(t)):a)}})]},t)})]})]})]})}var S=a(1207),C=a(2743);let R=()=>(0,l.jsxs)("div",{className:"pointer-events-none fixed inset-0 -z-10",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-amber-50 via-amber-100 to-amber-50"}),(0,l.jsxs)("svg",{className:"absolute inset-0 w-full h-full opacity-20 mix-blend-multiply",children:[(0,l.jsx)("defs",{children:(0,l.jsxs)("pattern",{id:"runes",width:"120",height:"120",patternUnits:"userSpaceOnUse",children:[(0,l.jsx)("text",{x:"8",y:"28",className:"fill-amber-900/50 text-[22px] font-serif",children:"ᚠᚢᚦᚨᚱ"}),(0,l.jsx)("text",{x:"36",y:"70",className:"fill-amber-900/40 text-[18px] font-serif",children:"ᚷᚹᚺᚾᛁ"}),(0,l.jsx)("text",{x:"18",y:"108",className:"fill-amber-900/30 text-[20px] font-serif",children:"ᛃᛇᛈᛉᛋ"})]})}),(0,l.jsx)("rect",{width:"100%",height:"100%",fill:"url(#runes)"})]}),(0,l.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-amber-200/40"}),(0,l.jsx)("div",{className:"absolute inset-0 shadow-[inset_0_0_180px_rgba(0,0,0,0.25)]"})]});function I(){var e;let t=(0,s.useRouter)(),a="string"==typeof(null===(e=t.query)||void 0===e?void 0:e.idea)?t.query.idea:"",i="storyforge.session.v1",u="storyforge.prime.lock.v1",[h,p]=(0,r.useState)(""),[g,x]=(0,r.useState)(a||""),[b,y]=(0,r.useState)((0,w.RH)("6-8")),[v,j]=(0,r.useState)("fantasy"),[N,I]=(0,r.useState)("short"),[M,H]=(0,r.useState)(8),[L,O]=(0,r.useState)(""),[U,T]=(0,r.useState)("warm, whimsical, gentle-humor"),[E,Z]=(0,r.useState)(!1),[F,_]=(0,r.useState)(null),[B,P]=(0,r.useState)(void 0),[J,z]=(0,r.useState)(null),[A,W]=(0,r.useState)([]),[$,q]=(0,r.useState)(null),[Y,V]=(0,r.useState)([]),[G,D]=(0,r.useState)(""),[X,K]=(0,r.useState)(!1),Q=(0,r.useRef)(!1);function ee(){z(null),W([]),V([])}async function et(){{(0,C.$y)();let e={title:h,premise:g,ageRange:(0,w.RH)(b),genre:v,chapterLength:N,chaptersTarget:M,keypoints:L,style:U,coverUrl:$};try{let t=window.localStorage.getItem(i),a={...t?JSON.parse(t):{},...e,toc:null,chapters:[],scenes:[],seedSignature:void 0};window.localStorage.setItem(i,JSON.stringify(a))}catch(e){}t.push("/Outline/?reseed=1")}}async function ea(){try{if(!A.length)return;let e=Y.length,t=A[e];Z(!0),_(null);let a=(0,w.RH)(b),l=(0,w.BU)(a),r={title:h||"Untitled Codex",premise:g,toc:J,priorHtml:Y.map(e=>e.html),keypoints:L,genre:v,ageRange:a,lengthHint:l,style:U,chapterLength:N},s="[context: genre=".concat(v,"; age=").concat(a,"; style=").concat(U,"; notes=").concat((L||"").slice(0,120),"]"),n=G&&G.trim()?"".concat(s," ").concat(G.trim()):s,{html:i}=await (0,C.Yl)({context:r,chapterIndex:e,influence:n}),c=null;try{c=(await (0,C.km)("".concat(h," (ages ").concat((0,w.RH)(b),"): ").concat(t.heading,". ").concat(i.slice(0,180),"..."))).url}catch(e){}V(e=>[...e,{chapterId:t.id,chapterHeading:t.heading,html:i,imageUrl:c}]),D("")}catch(e){_(e.message||"Chapter failed")}finally{Z(!1)}}async function el(){try{Z(!0),_(null);let e={htmlPages:Y.map(e=>{let t=e.imageUrl?'<img src="'.concat(e.imageUrl,'" alt="Scene for Chapter ').concat(e.chapterId,": ").concat(e.chapterHeading,'" style="max-width:100%;height:auto;border:1px solid #e2c084;border-radius:12px;margin:12px 0;"/>'):"";return"".concat(t,"\n").concat(e.html)}),coverUrl:$,meta:{title:h,toc:J,chapters:A},scenes:Y};try{(0,C.qQ)(e)}catch(e){}let{downloadUrl:t,filename:a}=await (0,C.WF)(e);if(t){let e=document.createElement("a");e.href=t,e.download=a||"".concat(h||"storybook",".html"),document.body.appendChild(e),e.click(),e.remove(),t.startsWith("blob:")&&URL.revokeObjectURL(t);return}let l=new Blob([JSON.stringify({title:h,toc:J,chapters:A,scenes:Y,coverUrl:$},null,2)],{type:"application/json"}),r=URL.createObjectURL(l),s=document.createElement("a");s.href=r,s.download="".concat(h||"storybook",".json"),document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(r)}finally{Z(!1)}}(0,r.useEffect)(()=>{try{let e=window.localStorage.getItem(i),t=e?JSON.parse(e):{},l=(null==t?void 0:t.premise)||"";if(a&&a!==l){p(""),x(a),y((0,w.RH)(t.ageRange||"6-8")),j(t.genre||"fantasy"),I(t.chapterLength||"medium"),H("number"==typeof t.chaptersTarget?t.chaptersTarget:8),O(""),T(t.style||"warm, whimsical, gentle-humor"),z(null),W([]),q(t.coverUrl||null),V([]),D("");try{let e={...t,title:"",premise:a,toc:null,chapters:[],scenes:[],seedSignature:void 0,keypoints:""};window.localStorage.setItem(i,JSON.stringify(e))}catch(e){}return}if(t){if(p(t.title||""),x(a||l||""),y((0,w.RH)(t.ageRange||"6-8")),j(t.genre||"fantasy"),I(t.chapterLength||"medium"),H("number"==typeof t.chaptersTarget?t.chaptersTarget:8),O(a?"":t.keypoints||""),T(t.style||"warm, whimsical, gentle-humor"),a){z(null),W([]),V([]);try{let e={...t,keypoints:"",toc:null,chapters:[],scenes:[],seedSignature:void 0};window.localStorage.setItem(i,JSON.stringify(e))}catch(e){}}else z(t.toc||null),W(Array.isArray(t.chapters)?t.chapters:[]),V(Array.isArray(t.scenes)?t.scenes:[]);q(t.coverUrl||null),D("")}}catch(e){}finally{K(!0)}},[a]),(0,r.useEffect)(()=>{if(X){ee();try{let e=window.localStorage.getItem(i),t={...e?JSON.parse(e):{},toc:null,chapters:[],scenes:[],seedSignature:void 0};window.localStorage.setItem(i,JSON.stringify(t))}catch(e){}}},[M,X]);let er=(0,r.useRef)(!1);(0,r.useEffect)(()=>{if(X&&!er.current)try{let e=JSON.stringify({title:h,premise:g,ageRange:(0,w.RH)(b),genre:v,chaptersTarget:M,keypoints:L,style:U}),t=window.localStorage.getItem(i),a=t?JSON.parse(t):{};if((null==a?void 0:a.seedSignature)!==e){er.current=!0;try{window.localStorage.setItem(i,JSON.stringify({...a,toc:null,chapters:[],scenes:[],seedSignature:void 0,title:h,premise:g,ageRange:(0,w.RH)(b),genre:v,chaptersTarget:M,keypoints:L,style:U}))}catch(e){}}}catch(e){}},[X,h,g,b,v,M,L,U,t]),(0,r.useEffect)(()=>{let e={title:h,premise:g,ageRange:(0,w.RH)(b),genre:v,chapterLength:N,chaptersTarget:M,keypoints:L,style:U,toc:J,chapters:A,coverUrl:$,scenes:Y};try{window.localStorage.setItem(i,JSON.stringify(e))}catch(e){}},[h,g,b,v,M,L,U,J,A,$,Y]),(0,r.useEffect)(()=>{X&&(async()=>{if(a&&!A.length&&!J){try{let e=JSON.stringify({idea:a}),t=window.sessionStorage.getItem(u);if(Q.current||t===e)return;Q.current=!0,window.sessionStorage.setItem(u,e)}catch(e){}try{Z(!0),P("Fetching seed info…");let{info:e}=await (0,C.o9)({prompt:a});if(e){if("string"==typeof e)x(e||"");else{if(e.title&&p(e.title),e.description&&x(e.description),e.ageRange&&y((0,w.RH)(e.ageRange)),e.genre&&j(e.genre),"number"==typeof e.chapters&&H(e.chapters),e.chapterLength){let t=(e.chapterLength||"").toString().toLowerCase();["tiny","short","medium","long"].includes(t)&&I(t)}e.keypoints&&O(e.keypoints),e.style&&T(e.style)}let t=(0,S.Z)(e.title||h||"Untitled Codex",(e.description||g||"").split("\n").slice(0,2).join("\n"));try{P("Generating cover image…");let e=await (0,C.km)(t);q(e.url)}catch(e){}}}catch(e){_(e.message||"Prime failed")}finally{Z(!1),P(void 0)}}})()},[a,X]);let es=async()=>{try{let e=(0,S.Z)(h||"Untitled Codex",(g||"").split("\n").slice(0,2).join("\n"));P("Regenerating cover image…");let t=await (0,C.km)(e);q(t.url)}catch(e){}finally{P(void 0)}},en=async e=>{try{let t=Y[e];if(!t)return;let a="".concat(h," (ages ").concat((0,w.RH)(b),"): Chapter ").concat(t.chapterId," - ").concat(t.chapterHeading,". ").concat(t.html.replace(/<[^>]+>/g," ").slice(0,180),"..."),l=await (0,C.km)(a);V(t=>t.map((t,a)=>a===e?{...t,imageUrl:l.url}:t))}catch(t){V(t=>t.map((t,a)=>a===e?{...t,imageUrl:null}:t))}};return(0,l.jsxs)("div",{className:"min-h-screen text-amber-950",children:[(0,l.jsx)(R,{}),(0,l.jsx)("header",{className:"relative",children:(0,l.jsxs)("div",{className:"mx-auto max-w-6xl px-4 py-10",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(n.E.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-2xl bg-amber-200/70 p-2 shadow",children:(0,l.jsx)(c,{className:"h-6 w-6"})}),(0,l.jsx)(n.E.h1,{initial:{opacity:0,y:0},animate:{opacity:1,y:0},className:"text-3xl md:text-4xl font-serif tracking-wide",children:"The Storyforge Terminal"})]}),(0,l.jsxs)("p",{className:"mt-2 max-w-2xl text-amber-900/80",children:["This site ",(0,l.jsx)("em",{children:"is"})," the relic. Seed a tale, step through each engraved chapter, and watch the images appear."]})]})}),(0,l.jsxs)("main",{className:"relative mx-auto max-w-6xl px-4 pb-28",children:[(0,l.jsxs)("div",{className:"mt-0 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,l.jsx)("div",{className:"lg:col-span-2",children:(0,l.jsx)(f,{state:{title:h,premise:g,ageRange:b,genre:v,chapterLength:N,chapters:M,keypoints:L,style:U,loading:E,status:B,error:F,baseLabel:C.tH.replace("https://","")},actions:{setTitle:function(e){p(e),ee()},setPremise:function(e){x(e),ee()},setAgeRange:y,setGenre:j,setChapterLength:I,setChapters:H,setKeypoints:O,setStyle:T,onSeed:et,onPrime:async()=>{try{Z(!0),P("Fetching seed info…"),_(null);let{info:e}=await (0,C.o9)({prompt:a||g});if(e){if((e.title&&e.title!==h||e.description&&e.description!==g)&&ee(),e.title&&p(e.title),e.description&&x(e.description),e.ageRange&&y((0,w.RH)(e.ageRange)),e.genre&&j(e.genre),"number"==typeof e.chapters&&H(e.chapters),e.chapterLength){let t=(e.chapterLength||"").toString().toLowerCase();["tiny","short","medium","long"].includes(t)&&I(t)}e.keypoints&&O(e.keypoints),e.style&&T(e.style);let t=(0,S.Z)(e.title||h||"Untitled Codex",(e.description||g||"").split("\n").slice(0,2).join("\n"));try{P("Generating cover image…");let e=await (0,C.km)(t);q(e.url)}catch(e){}}}catch(e){_(e.message||"Prime failed")}finally{Z(!1),P(void 0)}}}})}),(0,l.jsx)("div",{children:(0,l.jsx)(o.T,{coverUrl:$,title:h||"Untitled Codex",onBroken:es})})]}),A.length>0&&(0,l.jsx)("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6",children:(0,l.jsx)("div",{className:"lg:col-span-3",children:(0,l.jsx)(k,{outline:{title:h,toc:J},chapters:A,scenes:Y,influence:G,setInfluence:D,onNext:ea,onExport:el,onPrev:function(){0!==Y.length&&V(e=>e.slice(0,e.length-1))},onSceneImageBroken:en,ageRange:b})})}),A.length>0&&Y.length<A.length&&(0,l.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-20",children:(0,l.jsx)("div",{className:"mx-auto max-w-6xl px-4 pb-4",children:(0,l.jsxs)("div",{className:"rounded-2xl border border-amber-300 bg-amber-50/80 backdrop-blur px-3 py-3 shadow-lg",children:[(0,l.jsx)("div",{className:"text-xs uppercase text-amber-900/60 mb-2",children:"Influence the next step"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(m,{value:G,onChange:e=>D(e.target.value),placeholder:"A subtle hint (e.g., ‘lanterns sway in a 7/8 rhythm’)"}),(0,l.jsx)(d,{onClick:ea,disabled:E,children:"Apply & Continue"})]})]})})})]})]})}}},function(e){e.O(0,[154,913,743,888,774,179],function(){return e(e.s=2818)}),_N_E=e.O()}]);