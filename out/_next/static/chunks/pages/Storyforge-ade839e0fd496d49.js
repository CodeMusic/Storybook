(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[162],{2818:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Storyforge",function(){return a(9114)}])},7326:function(e,t,a){"use strict";a.d(t,{T:function(){return s}});var r=a(5893);a(7294);var n=a(9346);function s(e){let{coverUrl:t,title:a}=e;return(0,r.jsxs)(n.Zb,{className:"bg-amber-50/80 border-amber-300 overflow-hidden",children:[t&&(0,r.jsx)("img",{src:t,alt:"Cover",className:"w-full aspect-[4/3] object-cover"}),(0,r.jsx)(n.Ol,{children:(0,r.jsx)(n.ll,{className:"text-amber-950",children:"Codex Core"})}),(0,r.jsxs)(n.aY,{className:"text-sm",children:[(0,r.jsx)("div",{className:"text-amber-900/70 uppercase text-xs",children:"Title"}),(0,r.jsx)("div",{className:"font-serif text-lg",children:a})]})]})}},9346:function(e,t,a){"use strict";a.d(t,{Ol:function(){return s},Zb:function(){return n},aY:function(){return i},ll:function(){return l}});var r=a(5893);a(7294);let n=e=>{let{className:t="",...a}=e;return(0,r.jsx)("div",{className:"rounded-2xl border bg-white ".concat(t),...a})},s=e=>{let{className:t="",...a}=e;return(0,r.jsx)("div",{className:"px-4 py-3 border-b ".concat(t),...a})},l=e=>{let{className:t="",...a}=e;return(0,r.jsx)("div",{className:"text-lg font-semibold ".concat(t),...a})},i=e=>{let{className:t="",...a}=e;return(0,r.jsx)("div",{className:"px-4 py-3 ".concat(t),...a})}},1207:function(e,t,a){"use strict";function r(e){let t=e.replace(/```[\s\S]*?```/g,"").replace(/\*\*(.*?)\*\*/g,"$1").split(/\r?\n/).map(e=>e.trim()).filter(Boolean).filter(e=>/^(\d+[\).]|[•\-*])\s+/.test(e)||/^\d+\s+/.test(e)),a=1;return t.map(e=>{let t=e.replace(/^\s*(?:\d+[\).]|[•\-*])\s*/,"").trim().split(/[—\-:\u2013]/),r=(t[0]||"").trim(),n=(t.slice(1).join("-")||"").trim()||void 0,s=a++;return{id:s,heading:r||"Chapter ".concat(s),synopsis:n}})}function n(e,t){let a=t.split(/\r?\n/).filter(Boolean).slice(0,2).join(", ");return"".concat(e,": ").concat(a,". Cozy watercolor, soft light, storybook composition, ancient relic/tech motif.")}a.d(t,{B:function(){return r},Z:function(){return n}})},9114:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return E}});var r=a(5893),n=a(7294),s=a(1163),l=a(1891),i=a(1134);let o=(0,i.Z)("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);var c=a(7326);let d=e=>{let{variant:t="primary",className:a="",...n}=e;return(0,r.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm font-medium transition-colors disabled:opacity-60 disabled:pointer-events-none"," ").concat({primary:"bg-amber-600 text-white hover:bg-amber-700",secondary:"bg-amber-100 text-amber-900 hover:bg-amber-200",ghost:"bg-transparent hover:bg-amber-100 text-amber-900"}[t]," ").concat(a),...n})};var p=a(9346);let u=e=>{let{className:t="",...a}=e;return(0,r.jsx)("input",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400 ".concat(t),...a})},m=e=>{let{className:t="",...a}=e;return(0,r.jsx)("textarea",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400 ".concat(t),...a})},h=(0,i.Z)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),x=(0,i.Z)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),g=(0,i.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),y=(0,i.Z)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);function f(e){let{state:t,actions:a}=e,{title:n,premise:s,ageRange:l,genre:i,chapters:o,keypoints:c,style:f,loading:b,status:j,error:v,baseLabel:N}=t,{setTitle:w,setPremise:k,setAgeRange:S,setGenre:C,setChapters:E,setKeypoints:O,setStyle:T,onSeed:U,onPrime:_}=a;return(0,r.jsxs)(p.Zb,{className:"relative backdrop-blur bg-amber-100/70 border-amber-300 shadow-xl rounded-2xl",children:[(0,r.jsxs)(p.Ol,{className:"flex justify-between",children:[(0,r.jsxs)(p.ll,{className:"flex items-center gap-2 text-amber-950",children:[(0,r.jsx)(h,{className:"h-5 w-5"})," Seed the Story Codex"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs text-amber-800/70",children:[(0,r.jsx)(x,{className:"h-4 w-4"})," Endpoint base: ",(0,r.jsx)("span",{className:"font-mono",children:N}),_&&(0,r.jsx)(d,{variant:"secondary",onClick:_,disabled:b,className:"ml-2 h-6 px-2 py-1 text-xs",children:"Retry seed info"})]})]}),(0,r.jsxs)(p.aY,{className:"grid grid-cols-1 md:grid-cols-5 gap-4 ".concat(b?"opacity-60":""),children:[(0,r.jsxs)("div",{className:"md:col-span-3 space-y-3",children:[(0,r.jsx)(u,{placeholder:"Title (optional)",value:n,onChange:e=>w(e.target.value)}),(0,r.jsx)(m,{placeholder:"Whisper your premise…",value:s,onChange:e=>k(e.target.value),rows:5})]}),(0,r.jsxs)("div",{className:"md:col-span-2 grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Age Range"}),(0,r.jsxs)("select",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400",value:l,onChange:e=>S(e.target.value),children:[(0,r.jsx)("option",{value:"4-6",children:"4–6"}),(0,r.jsx)("option",{value:"6-8",children:"6–8"}),(0,r.jsx)("option",{value:"8-10",children:"8–10"})]})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Genre"}),(0,r.jsxs)("select",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400",value:i,onChange:e=>C(e.target.value),children:[(0,r.jsx)("option",{value:"fantasy",children:"Fantasy"}),(0,r.jsx)("option",{value:"adventure",children:"Adventure"}),(0,r.jsx)("option",{value:"mystery",children:"Mystery"}),(0,r.jsx)("option",{value:"sci-fi",children:"Sci‑Fi"}),(0,r.jsx)("option",{value:"fairy-tale",children:"Fairy Tale"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"How many chapters?"}),(0,r.jsx)(u,{type:"number",min:3,max:20,value:o,onChange:e=>E(parseInt(e.target.value||"8"))})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Key points (optional)"}),(0,r.jsx)(m,{placeholder:"e.g., Chapter 2: the lantern goes out; Chapter 5: the map is mirrored",value:c,onChange:e=>O(e.target.value),rows:3})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Style Tags"}),(0,r.jsx)(u,{value:f,onChange:e=>T(e.target.value)})]}),(0,r.jsx)("div",{className:"flex items-end gap-2 col-span-2",children:(0,r.jsxs)(d,{onClick:U,disabled:b,className:"flex-1",children:[b?(0,r.jsx)(g,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(y,{className:"mr-2 h-4 w-4"}),"Build Outline"]})}),v&&(0,r.jsx)("div",{className:"col-span-2 rounded-xl border border-red-300 bg-red-50 p-3 text-red-800",children:v})]})]}),b&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-2xl bg-amber-100/60 backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"flex items-center gap-3 text-amber-900",children:[(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),(0,r.jsx)("span",{children:j||"Working… please wait"})]})})]})}let b=(0,i.Z)("StepBack",[["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["polygon",{points:"14,20 4,12 14,4",key:"ypakod"}]]),j=(0,i.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),v=(0,i.Z)("StepForward",[["line",{x1:"6",x2:"6",y1:"4",y2:"20",key:"fy8qot"}],["polygon",{points:"10,4 20,12 10,20",key:"1mc1pf"}]]),N=(0,i.Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function w(e){let{outline:t,chapters:a,scenes:n,influence:s,setInfluence:l,onNext:i,onExport:o,onPrev:c}=e,u=n.length>=a.length;return(0,r.jsxs)(p.Zb,{className:"bg-amber-50/80 border-amber-300",children:[(0,r.jsxs)(p.Ol,{className:"flex justify-between",children:[(0,r.jsx)(p.ll,{className:"text-amber-950",children:"Engraving the Chapters"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[!u&&n.length>0&&(0,r.jsxs)(d,{variant:"secondary",onClick:c,children:[(0,r.jsx)(b,{className:"mr-2 h-4 w-4"})," Back"]}),u?(0,r.jsxs)(d,{onClick:o,children:[(0,r.jsx)(j,{className:"mr-2 h-4 w-4"})," Export Book"]}):(0,r.jsxs)(d,{onClick:i,children:[(0,r.jsx)(v,{className:"mr-2 h-4 w-4"})," Read Next Chapter"]})]})]}),(0,r.jsxs)(p.aY,{className:"space-y-6",children:[(0,r.jsx)("ol",{className:"space-y-2",children:a.map((e,t)=>{let a=t<n.length,s=t===n.length&&!u;return(0,r.jsxs)("li",{className:"rounded-xl border p-3 ".concat(a?"border-emerald-300 bg-emerald-50/60":"border-amber-200 bg-white/60"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"font-serif font-semibold",children:[e.id,". ",e.heading]}),(0,r.jsx)("div",{className:"text-xs flex items-center gap-1",children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N,{className:"h-4 w-4 text-emerald-600"})," Engraved"]}):s?(0,r.jsx)(r.Fragment,{children:"…etching"}):(0,r.jsx)(r.Fragment,{children:"pending"})})]}),e.synopsis&&(0,r.jsx)("div",{className:"text-sm text-amber-900/80",children:e.synopsis})]},e.id)})}),n.length>0&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"text-amber-900/70 uppercase text-xs",children:"Story so far"}),n.map((e,t)=>(0,r.jsxs)("div",{className:"rounded-2xl border border-amber-200 bg-white/70 p-4",children:[(0,r.jsxs)("div",{className:"font-serif text-lg mb-2",children:["Chapter ",e.chapterId,": ",e.chapterHeading]}),e.imageUrl&&(0,r.jsx)("img",{src:e.imageUrl,alt:"Scene",className:"w-full h-auto rounded-lg border border-amber-200 mb-3"}),(0,r.jsx)("div",{className:"prose prose-amber max-w-none",dangerouslySetInnerHTML:{__html:e.html}})]},t))]})]})]})}var k=a(1207),S=a(2743);let C=()=>(0,r.jsxs)("div",{className:"pointer-events-none fixed inset-0 -z-10",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-amber-50 via-amber-100 to-amber-50"}),(0,r.jsxs)("svg",{className:"absolute inset-0 w-full h-full opacity-20 mix-blend-multiply",children:[(0,r.jsx)("defs",{children:(0,r.jsxs)("pattern",{id:"runes",width:"120",height:"120",patternUnits:"userSpaceOnUse",children:[(0,r.jsx)("text",{x:"8",y:"28",className:"fill-amber-900/50 text-[22px] font-serif",children:"ᚠᚢᚦᚨᚱ"}),(0,r.jsx)("text",{x:"36",y:"70",className:"fill-amber-900/40 text-[18px] font-serif",children:"ᚷᚹᚺᚾᛁ"}),(0,r.jsx)("text",{x:"18",y:"108",className:"fill-amber-900/30 text-[20px] font-serif",children:"ᛃᛇᛈᛉᛋ"})]})}),(0,r.jsx)("rect",{width:"100%",height:"100%",fill:"url(#runes)"})]}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-amber-200/40"}),(0,r.jsx)("div",{className:"absolute inset-0 shadow-[inset_0_0_180px_rgba(0,0,0,0.25)]"})]});function E(){var e;let t=(0,s.useRouter)(),a="string"==typeof(null===(e=t.query)||void 0===e?void 0:e.idea)?t.query.idea:"",i="storyforge.session.v1",[p,m]=(0,n.useState)(""),[h,x]=(0,n.useState)(a||""),[g,y]=(0,n.useState)("6-8"),[b,j]=(0,n.useState)("fantasy"),[v,N]=(0,n.useState)(8),[E,O]=(0,n.useState)(""),[T,U]=(0,n.useState)("warm, whimsical, gentle-humor"),[_,A]=(0,n.useState)(!1),[M,B]=(0,n.useState)(null),[R,L]=(0,n.useState)(void 0),[Z,I]=(0,n.useState)(null),[z,J]=(0,n.useState)([]),[P,H]=(0,n.useState)(null),[F,q]=(0,n.useState)([]),[W,G]=(0,n.useState)(""),[D,Y]=(0,n.useState)(!1);async function X(){try{let e=window.localStorage.getItem(i),t={...e?JSON.parse(e):{},title:p,premise:h,ageRange:g,genre:b,chaptersTarget:v,keypoints:E,style:T,coverUrl:P};window.localStorage.setItem(i,JSON.stringify(t))}catch(e){}t.push("/Outline")}async function V(){try{if(!z.length)return;let e=F.length,t=z[e];A(!0),B(null);let a={title:p||"Untitled Codex",toc:Z,priorHtml:F.map(e=>e.html),keypoints:E,genre:b,ageRange:g},{html:r}=await (0,S.Yl)({context:a,chapterIndex:e,influence:W.trim()||void 0}),n=null;try{n=(await (0,S.km)("".concat(p,": ").concat(t.heading,". ").concat(r.slice(0,180),"..."))).url}catch(e){}q(e=>[...e,{chapterId:t.id,chapterHeading:t.heading,html:r,imageUrl:n}]),G("")}catch(e){B(e.message||"Chapter failed")}finally{A(!1)}}async function $(){try{A(!0),B(null);let{downloadUrl:e}=await (0,S.WF)({htmlPages:F.map(e=>e.html),coverUrl:P,meta:{title:p,toc:Z,chapters:z}});if(e){window.open(e,"_blank");return}let t=new Blob([JSON.stringify({title:p,toc:Z,chapters:z,scenes:F,coverUrl:P},null,2)],{type:"application/json"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="".concat(p||"storybook",".json"),document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(a)}finally{A(!1)}}return(0,n.useEffect)(()=>{try{let e=window.localStorage.getItem(i);if(!e){Y(!0);return}let t=JSON.parse(e);t&&(m(t.title||""),x(t.premise||a||""),y(t.ageRange||"6-8"),j(t.genre||"fantasy"),N("number"==typeof t.chaptersTarget?t.chaptersTarget:8),O(t.keypoints||""),U(t.style||"warm, whimsical, gentle-humor"),I(t.toc||null),J(Array.isArray(t.chapters)?t.chapters:[]),H(t.coverUrl||null),q(Array.isArray(t.scenes)?t.scenes:[]),G(""))}catch(e){}finally{Y(!0)}},[]),(0,n.useEffect)(()=>{try{window.localStorage.setItem(i,JSON.stringify({title:p,premise:h,ageRange:g,genre:b,chaptersTarget:v,keypoints:E,style:T,toc:Z,chapters:z,coverUrl:P,scenes:F}))}catch(e){}},[p,h,g,b,v,E,T,Z,z,P,F]),(0,n.useEffect)(()=>{D&&(async()=>{if(a&&!z.length&&!Z)try{A(!0),L("Fetching seed info…");let{info:e}=await (0,S.o9)({prompt:a});if(e){"string"==typeof e?x(t=>t||e||""):(e.title&&m(e.title),e.description&&x(t=>t||e.description||""),e.ageRange&&y(e.ageRange),e.genre&&j(e.genre),"number"==typeof e.chapters&&N(e.chapters),e.keypoints&&O(e.keypoints),e.style&&U(e.style));let t=(0,k.Z)(e.title||p||"Untitled Codex",(e.description||h||"").split("\n").slice(0,2).join("\n"));try{L("Generating cover image…");let e=await (0,S.km)(t);H(e.url)}catch(e){}}}catch(e){B(e.message||"Prime failed")}finally{A(!1),L(void 0)}})()},[a,D]),(0,r.jsxs)("div",{className:"min-h-screen text-amber-950",children:[(0,r.jsx)(C,{}),(0,r.jsx)("header",{className:"relative",children:(0,r.jsxs)("div",{className:"mx-auto max-w-6xl px-4 py-10",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(l.E.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-2xl bg-amber-200/70 p-2 shadow",children:(0,r.jsx)(o,{className:"h-6 w-6"})}),(0,r.jsx)(l.E.h1,{initial:{opacity:0,y:0},animate:{opacity:1,y:0},className:"text-3xl md:text-4xl font-serif tracking-wide",children:"The Storyforge Terminal"})]}),(0,r.jsxs)("p",{className:"mt-2 max-w-2xl text-amber-900/80",children:["This site ",(0,r.jsx)("em",{children:"is"})," the relic. Seed a tale, step through each engraved chapter, and watch the images appear."]})]})}),(0,r.jsxs)("main",{className:"relative mx-auto max-w-6xl px-4 pb-28",children:[(0,r.jsxs)("div",{className:"mt-0 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsx)(f,{state:{title:p,premise:h,ageRange:g,genre:b,chapters:v,keypoints:E,style:T,loading:_,status:R,error:M,baseLabel:S.tH.replace("https://","")},actions:{setTitle:m,setPremise:x,setAgeRange:y,setGenre:j,setChapters:N,setKeypoints:O,setStyle:U,onSeed:X,onPrime:async()=>{try{A(!0),L("Fetching seed info…"),B(null);let{info:e}=await (0,S.o9)({prompt:a||h});if(e){e.title&&m(e.title),e.description&&x(t=>t||e.description||""),e.ageRange&&y(e.ageRange),e.genre&&j(e.genre),"number"==typeof e.chapters&&N(e.chapters),e.keypoints&&O(e.keypoints),e.style&&U(e.style);let t=(0,k.Z)(e.title||p||"Untitled Codex",(e.description||h||"").split("\n").slice(0,2).join("\n"));try{L("Generating cover image…");let e=await (0,S.km)(t);H(e.url)}catch(e){}}}catch(e){B(e.message||"Prime failed")}finally{A(!1),L(void 0)}}}})}),(0,r.jsx)("div",{children:(0,r.jsx)(c.T,{coverUrl:P,title:p||"Untitled Codex"})})]}),z.length>0&&(0,r.jsx)("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6",children:(0,r.jsx)("div",{className:"lg:col-span-3",children:(0,r.jsx)(w,{outline:{title:p,toc:Z},chapters:z,scenes:F,influence:W,setInfluence:G,onNext:V,onExport:$,onPrev:function(){0!==F.length&&q(e=>e.slice(0,e.length-1))}})})}),z.length>0&&F.length<z.length&&(0,r.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-20",children:(0,r.jsx)("div",{className:"mx-auto max-w-6xl px-4 pb-4",children:(0,r.jsxs)("div",{className:"rounded-2xl border border-amber-300 bg-amber-50/80 backdrop-blur px-3 py-3 shadow-lg",children:[(0,r.jsx)("div",{className:"text-xs uppercase text-amber-900/60 mb-2",children:"Influence the next step"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(u,{value:W,onChange:e=>G(e.target.value),placeholder:"A subtle hint (e.g., ‘lanterns sway in a 7/8 rhythm’)"}),(0,r.jsx)(d,{onClick:V,disabled:_,children:"Apply & Continue"})]})]})})})]})]})}},2743:function(e,t,a){"use strict";a.d(t,{Mq:function(){return h},WF:function(){return f},Yl:function(){return x},bV:function(){return o},km:function(){return y},o9:function(){return b},tH:function(){return s}});var r=a(4406),n=a(8834).lW;let s="https://n8n.codemusic.ca/webhook",l=r.env.NEXT_PUBLIC_N8N_USER||"siteuser",i=r.env.NEXT_PUBLIC_N8N_PASS||"codemusai",o={prime:"".concat(s,"/seedInfo"),seed:"".concat(s,"/seedStory"),chapter:"".concat(s,"/expandChapter"),image:"".concat(s,"/genImage"),export:"".concat(s,"/exportBook")};function c(){let e="".concat(l,":").concat(i);try{let t="function"==typeof btoa?btoa(e):n.from(e).toString("base64");return"Basic ".concat(t)}catch(e){return""}}function d(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e5,r=new AbortController,n=setTimeout(()=>r.abort(),a);return fetch(e,{...t,signal:r.signal}).finally(()=>clearTimeout(n))}async function p(e,t){let a=await d(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:c()},body:JSON.stringify(t)}),r=await a.text();if(!a.ok)throw Error(r||"Endpoint error ".concat(a.status));if(!r)throw Error("Empty response");return r}async function u(e,t){let a=await d(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:c()},body:JSON.stringify(t)}),r=await a.text();if(!a.ok)throw Error(r||"Endpoint error ".concat(a.status));try{return JSON.parse(r)}catch(e){throw Error("Invalid JSON response")}}async function m(e,t){let a=await d(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:c()},body:JSON.stringify(t)}),r=await a.text();if(!a.ok)throw Error(r||"Endpoint error ".concat(a.status));return r}async function h(e){console.log("DEBUG seedStory: endpoint =",o.seed),console.log("DEBUG seedStory: payload =",e);try{let t=await p(o.seed,e);console.log("DEBUG seedStory: raw response =",t);let a=function(e){let t=(e||"").toString().trim();if(!t)return t;try{let e=JSON.parse(t);if(Array.isArray(e)&&e.length>0){let t=e[0];if("string"==typeof(null==t?void 0:t.toc))return t.toc;if("string"==typeof(null==t?void 0:t.output))return t.output}if("object"==typeof e&&e){if("string"==typeof e.toc)return e.toc;if("string"==typeof e.output)return e.output}}catch(e){}return t}(t);return console.log("DEBUG seedStory: parsed toc =",a),{toc:a}}catch(e){throw console.error("DEBUG seedStory: error =",e),e}}async function x(e){return{html:function e(t){let a=(t||"").toString().trim();if(!a)return"";try{let t=JSON.parse(a);if(Array.isArray(t)&&t.length>0){let a=t[0];if("string"==typeof(null==a?void 0:a.html))return a.html;if("string"==typeof(null==a?void 0:a.output))return e(a.output)}if("object"==typeof t&&t){if("string"==typeof t.html)return t.html;if("string"==typeof t.output)return e(t.output)}}catch(e){}return/[<][a-zA-Z!/?]/.test(a)?a:a.split(/\n{2,}/).map(e=>e.trim()).filter(Boolean).map(e=>{let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br/>");return"<p>".concat(t,"</p>")}).join("\n")}(await p(o.chapter,e))}}async function g(e,t){let a=await d(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:c()},body:JSON.stringify(t)}),r=a.headers.get("content-type")||"";if(!a.ok)throw Error(await a.text().catch(()=>"")||"Endpoint error ".concat(a.status));if(r.startsWith("image/")){let e=await a.blob();return URL.createObjectURL(e)}let n=await a.text();try{let e=JSON.parse(n);if("string"==typeof(null==e?void 0:e.url))return e.url;if("string"==typeof(null==e?void 0:e.data)){let t=(null==e?void 0:e.mime)||(null==e?void 0:e.type)||"image/png";if(e.data.startsWith("data:"))return e.data;return"data:".concat(t,";base64,").concat(e.data)}}catch(e){}let s=n.trim();if(!s)throw Error("Empty response");return s}async function y(e){return{url:await g(o.image,{prompt:e})}}async function f(e){try{return{downloadUrl:await p(o.export,e)}}catch(e){return{downloadUrl:null}}}async function b(e){try{let t=await u(o.prime,e),a=e=>{let t=(e||"").trim(),a=t.match(/```\s*json\s*([\s\S]*?)```/i)||t.match(/```\s*([\s\S]*?)```/i),r=(a?a[1]:t).trim();r=r.replace(/^\s*\(\s*/,"").replace(/\s*\)\s*$/,"");try{let e=JSON.parse(r);if(e&&"object"==typeof e){let t={title:e.title,description:e.description,ageRange:e.ageRange,genre:e.genre,chapters:e.chapters,keypoints:e.keypoints,style:e.style};if(Object.values(t).some(e=>null!=e&&""!==e))return t}}catch(e){}let n=t.split(/\r?\n/).filter(Boolean);return n.length>=3&&n.slice(0,3).every(e=>/^(\s*(\d+[\).]|[•\-*])\s*)?/.test(e))?{toc:t}:{description:t}};if(Array.isArray(t)&&t.length>0){let e=t[0];if("string"==typeof(null==e?void 0:e.output))return{info:a(e.output)};if(e&&"object"==typeof e)return{info:e}}if("string"==typeof(null==t?void 0:t.output))return{info:a(t.output)};return{info:t}}catch(t){try{let t=(await m(o.prime,e)||"").toString().trim();return{info:t?{description:t}:{}}}catch(e){throw e}}}}},function(e){e.O(0,[295,891,888,774,179],function(){return e(e.s=2818)}),_N_E=e.O()}]);