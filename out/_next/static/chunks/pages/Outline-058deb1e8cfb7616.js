(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[485],{4349:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Outline",function(){return a(7563)}])},3432:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(1134).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},7563:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var s=a(5893),r=a(7294),l=a(1163),i=a(1891);let n=(0,a(1134).Z)("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);var c=a(3432),o=a(7326),d=a(1207),u=a(2743);function m(){let e=(0,l.useRouter)(),t="storyforge.session.v1",[a,m]=(0,r.useState)(""),[p,g]=(0,r.useState)(""),[h,x]=(0,r.useState)("6-8"),[f,y]=(0,r.useState)("fantasy"),[b,S]=(0,r.useState)(8),[v,N]=(0,r.useState)(""),[w,j]=(0,r.useState)("warm, whimsical, gentle-humor"),[E,O]=(0,r.useState)(null),[k,C]=(0,r.useState)(!0),[U,B]=(0,r.useState)(null),[_,I]=(0,r.useState)(null),[J,R]=(0,r.useState)([]),[T,D]=(0,r.useState)([]),[G,z]=(0,r.useState)(!1),[A,M]=(0,r.useState)(0),Z=(0,r.useRef)(!1);return(0,r.useEffect)(()=>{try{let a=window.localStorage.getItem(t);if(a){var e;let s=JSON.parse(a);if(s.premise&&s.premise.includes("Cannot access uninitialized variable")){console.log("DEBUG: Sanitizing corrupted premise in localStorage"),s.premise="";try{window.localStorage.setItem(t,JSON.stringify(s))}catch(e){}}m(null!==(e=s.title)&&void 0!==e?e:""),g(s.premise||""),x(s.ageRange||"6-8"),y(s.genre||"fantasy"),S("number"==typeof s.chaptersTarget?s.chaptersTarget:8),N(s.keypoints||""),j(s.style||"warm, whimsical, gentle-humor"),O(s.coverUrl||null),I(s.toc||null),R(Array.isArray(s.chapters)?s.chapters:[]);try{let e=(Array.isArray(s.scenes)?s.scenes:[]).map(e=>null==e?void 0:e.chapterId).filter(e=>"number"==typeof e);D(e)}catch(e){}}}catch(e){console.error("DEBUG Outline: localStorage error =",e)}finally{z(!0)}},[]),(0,r.useEffect)(()=>{(async()=>{try{if(console.log("DEBUG Outline useEffect: hydrated =",G,"toc =",_),!G)return;let e=JSON.stringify({title:a,premise:p,ageRange:h,genre:f,chaptersTarget:b,keypoints:v,style:w});try{let a=window.localStorage.getItem(t),s=a?JSON.parse(a):{};if(s.seedSignature!==e){let a={...s,seedSignature:e,toc:null,chapters:[]};try{window.localStorage.setItem(t,JSON.stringify(a))}catch(e){}I(null),R([])}}catch(e){}if(_&&0===A&&0===J.length){let e=(_||"").replace(/```[\s\S]*?```/g,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/^[^\n]*Table of Contents[^\n]*\n?/i,"").replace(/^Based on[\s\S]*?:\n+/i,""),a=(0,d.B)(e);I(e),R(a);try{let s=window.localStorage.getItem(t),r={...s?JSON.parse(s):{},toc:e,chapters:a};window.localStorage.setItem(t,JSON.stringify(r))}catch(e){}return}if(_&&0===A||Z.current)return;let s="Cannot access uninitialized variable",r=a&&!a.includes(s)?a:"",l=p&&!p.includes(s)?p:"";if(console.log("DEBUG Outline: evaluating seed readiness. titleSafe =",r,"premiseSafe =",l),C(!0),B(null),Z.current=!0,!(r&&r.trim()||l&&l.trim())){console.log("DEBUG Outline: Missing title/premise after sanitize, setting error"),B("Missing seed info. Return and provide an idea or description."),C(!1);return}let i={title:r||"Untitled Codex",premise:l||r,prompt:l||r||"Untitled Codex",ageRange:h,genre:f,chapters:b,keypoints:v||void 0,style:w};console.log("DEBUG Outline: Sending payload to seedStory @",(null===u.bV||void 0===u.bV?void 0:u.bV.seed)||"n/a","payload =",i);let{toc:n}=await (0,u.Mq)(i);console.log("DEBUG: Received TOC:",n);let c=(n||"").replace(/```[\s\S]*?```/g,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/^[^\n]*Table of Contents[^\n]*\n?/i,"").replace(/^Based on[\s\S]*?:\n+/i,"");I(c);let o=(0,d.B)(c);R(o);try{let e=window.localStorage.getItem(t),a={...e?JSON.parse(e):{},toc:c,chapters:o};window.localStorage.setItem(t,JSON.stringify(a))}catch(e){}}catch(e){B((null==e?void 0:e.message)||"Seeding outline failed")}finally{C(!1),Z.current=!1,A>0&&M(0)}})()},[G,A,a,p,h,f,b,v,w]),(0,s.jsxs)("div",{className:"min-h-screen text-amber-950",children:[(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)("div",{className:"mx-auto max-w-6xl px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(i.E.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-2xl bg-amber-200/70 p-2 shadow",children:(0,s.jsx)(n,{className:"h-6 w-6"})}),(0,s.jsx)(i.E.h1,{initial:{opacity:0,y:0},animate:{opacity:1,y:0},className:"text-2xl md:text-3xl font-serif tracking-wide",children:"Outline"})]}),(0,s.jsx)("p",{className:"mt-1 text-amber-900/80",children:a||"Untitled Codex"})]})}),(0,s.jsx)("main",{className:"relative mx-auto max-w-6xl px-4 pb-20",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsx)(o.T,{coverUrl:E,title:a||"Untitled Codex"})}),(0,s.jsxs)("div",{className:"lg:col-span-2",children:[(0,s.jsxs)("div",{className:"relative rounded-2xl border border-amber-300 bg-amber-50/70 p-4 min-h-[240px]",children:[k&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-2xl bg-amber-100/60 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"flex items-center gap-3 text-amber-900",children:[(0,s.jsx)(c.Z,{className:"h-5 w-5 animate-spin"}),(0,s.jsx)("span",{children:"Engraving your table of contentsâ€¦"})]})}),U&&(0,s.jsxs)("div",{className:"rounded-xl border border-red-300 bg-red-50 p-3 text-red-800",children:[(0,s.jsx)("div",{children:U}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("button",{onClick:()=>M(e=>e+1),className:"rounded-lg bg-red-600 text-white px-3 py-1 text-xs",children:"Retry seeding"})})]}),!k&&!U&&J.length>0&&(0,s.jsx)("ol",{className:"space-y-2",children:J.map(t=>{let r=T.includes(t.id);return(0,s.jsxs)("li",{className:"rounded-xl border p-3 cursor-pointer ".concat(r?"border-emerald-300 bg-emerald-50/60":"border-amber-200 bg-white/70"),onClick:()=>e.push({pathname:"/Read",query:{chapter:t.id,title:a||"Untitled Codex"}}),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"font-serif font-semibold",children:[t.id,". ",t.heading]}),(0,s.jsx)("div",{className:"text-xs text-amber-900/70",children:r?"engraved":"tap to generate"})]}),t.synopsis&&(0,s.jsx)("div",{className:"text-sm text-amber-900/80",children:t.synopsis})]},t.id)})}),!k&&!U&&0===J.length&&(0,s.jsx)("div",{className:"text-amber-900/80",children:"No chapters detected. Please adjust your seed or retry."})]}),(0,s.jsx)("div",{className:"mt-4 flex justify-end gap-2",children:J.length>0&&T.length>=J.length&&(0,s.jsx)("button",{onClick:()=>e.push("/Read?export=1"),className:"inline-flex items-center justify-center rounded-xl bg-amber-600 text-white px-5 py-3 shadow hover:bg-amber-700",disabled:k,children:"Export Full Book"})})]})]})})]})}}},function(e){e.O(0,[295,891,916,888,774,179],function(){return e(e.s=4349)}),_N_E=e.O()}]);