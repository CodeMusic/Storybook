(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[485],{4349:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Outline",function(){return a(7563)}])},3432:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(1134).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},7563:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var s=a(5893),i=a(7294),l=a(1163),n=a(1891);let r=(0,a(1134).Z)("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);var c=a(3432),o=a(7326),d=a(1207),u=a(2743);function m(){let e=(0,l.useRouter)(),t="storyforge.session.v1",[a,m]=(0,i.useState)(""),[p,h]=(0,i.useState)(""),[g,x]=(0,i.useState)("6-8"),[f,y]=(0,i.useState)("fantasy"),[b,v]=(0,i.useState)(8),[S,w]=(0,i.useState)(""),[N,j]=(0,i.useState)("warm, whimsical, gentle-humor"),[O,E]=(0,i.useState)(null),[k,C]=(0,i.useState)(!0),[U,B]=(0,i.useState)(null),[_,R]=(0,i.useState)(null),[I,J]=(0,i.useState)([]),[T,z]=(0,i.useState)([]),[D,G]=(0,i.useState)(!1),[A,M]=(0,i.useState)(0),H=(0,i.useRef)(!1);return(0,i.useEffect)(()=>{try{let a=window.localStorage.getItem(t);if(a){var e;let s=JSON.parse(a),i=new URLSearchParams(window.location.search),l=(null==i?void 0:i.get("reseed"))==="1";if(s.premise&&s.premise.includes("Cannot access uninitialized variable")){console.log("DEBUG: Sanitizing corrupted premise in localStorage"),s.premise="";try{window.localStorage.setItem(t,JSON.stringify(s))}catch(e){}}if(m(null!==(e=s.title)&&void 0!==e?e:""),h(s.premise||""),x(s.ageRange||"6-8"),y(s.genre||"fantasy"),v("number"==typeof s.chaptersTarget?s.chaptersTarget:8),w(s.keypoints||""),j(s.style||"warm, whimsical, gentle-humor"),E(s.coverUrl||null),l){R(null),J([]);try{let e={...s,toc:null,chapters:[],seedSignature:void 0};window.localStorage.setItem(t,JSON.stringify(e))}catch(e){}}else R(s.toc||null),J(Array.isArray(s.chapters)?s.chapters:[]);try{let e=(Array.isArray(s.scenes)?s.scenes:[]).map(e=>null==e?void 0:e.chapterId).filter(e=>"number"==typeof e);z(e)}catch(e){}}}catch(e){console.error("DEBUG Outline: localStorage error =",e)}finally{G(!0)}},[]),(0,i.useEffect)(()=>{(async()=>{try{if(console.log("DEBUG Outline useEffect: hydrated =",D,"toc =",_),!D)return;let e=JSON.stringify({title:a,premise:p,ageRange:g,genre:f,chaptersTarget:b,keypoints:S,style:N});try{let a=window.localStorage.getItem(t),s=a?JSON.parse(a):{};if(s.seedSignature!==e){let a={...s,seedSignature:e,toc:null,chapters:[]};try{window.localStorage.setItem(t,JSON.stringify(a))}catch(e){}R(null),J([]);return}}catch(e){}let s=new URLSearchParams(window.location.search),i=(null==s?void 0:s.get("reseed"))==="1";if(!i&&_&&0===A&&0===I.length){let e=(_||"").replace(/```[\s\S]*?```/g,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/^[^\n]*Table of Contents[^\n]*\n?/i,"").replace(/^Based on[\s\S]*?:\n+/i,""),a=(0,d.B)(e);R(e),J(a);try{let s=window.localStorage.getItem(t),i={...s?JSON.parse(s):{},toc:e,chapters:a};window.localStorage.setItem(t,JSON.stringify(i))}catch(e){}return}if(!i&&_&&0===A||H.current)return;let l="Cannot access uninitialized variable",n=a&&!a.includes(l)?a:"",r=p&&!p.includes(l)?p:"";if(console.log("DEBUG Outline: evaluating seed readiness. titleSafe =",n,"premiseSafe =",r),C(!0),B(null),H.current=!0,!(n&&n.trim()||r&&r.trim())){console.log("DEBUG Outline: Missing title/premise after sanitize, setting error"),B("Missing seed info. Return and provide an idea or description."),C(!1);return}let c={title:n||"Untitled Codex",premise:r||n,prompt:r||n||"Untitled Codex",ageRange:g,genre:f,chapters:b,keypoints:S||void 0,style:N,policyHint:"Fictionalize any sensitive or political content; avoid real names; keep it age-appropriate and non-political."};console.log("DEBUG Outline: Sending payload to seedStory @",(null===u.bV||void 0===u.bV?void 0:u.bV.seed)||"n/a","payload =",c);let{toc:o}=await (0,u.Mq)(c);console.log("DEBUG: Received TOC:",o);let m=(o||"").replace(/```[\s\S]*?```/g,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/^[^\n]*Table of Contents[^\n]*\n?/i,"").replace(/^Based on[\s\S]*?:\n+/i,"");R(m);let h=(0,d.B)(m);J(h);try{let e=window.localStorage.getItem(t),a={...e?JSON.parse(e):{},toc:m,chapters:h};window.localStorage.setItem(t,JSON.stringify(a))}catch(e){}}catch(e){B((null==e?void 0:e.message)||"Seeding outline failed")}finally{C(!1),H.current=!1,A>0&&M(0)}})()},[D,A,a,p,g,f,b,S,N]),(0,s.jsxs)("div",{className:"min-h-screen text-amber-950",children:[(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)("div",{className:"mx-auto max-w-6xl px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(n.E.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-2xl bg-amber-200/70 p-2 shadow",children:(0,s.jsx)(r,{className:"h-6 w-6"})}),(0,s.jsx)(n.E.h1,{initial:{opacity:0,y:0},animate:{opacity:1,y:0},className:"text-2xl md:text-3xl font-serif tracking-wide",children:"Outline"})]}),(0,s.jsx)("p",{className:"mt-1 text-amber-900/80",children:a||"Untitled Codex"})]})}),(0,s.jsx)("main",{className:"relative mx-auto max-w-6xl px-4 pb-20",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsx)(o.T,{coverUrl:O,title:a||"Untitled Codex"})}),(0,s.jsxs)("div",{className:"lg:col-span-2",children:[(0,s.jsxs)("div",{className:"relative rounded-2xl border border-amber-300 bg-amber-50/70 p-4 min-h-[240px]",children:[k&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-2xl bg-amber-100/60 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"flex items-center gap-3 text-amber-900",children:[(0,s.jsx)(c.Z,{className:"h-5 w-5 animate-spin"}),(0,s.jsx)("span",{children:"Engraving your table of contentsâ€¦"})]})}),U&&(0,s.jsxs)("div",{className:"rounded-xl border border-red-300 bg-red-50 p-3 text-red-800",children:[(0,s.jsx)("div",{children:U}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("button",{onClick:()=>M(e=>e+1),className:"rounded-lg bg-red-600 text-white px-3 py-1 text-xs",children:"Retry seeding"})})]}),!k&&!U&&I.length>0&&(0,s.jsx)("ol",{className:"space-y-2",children:I.map(t=>{let i=T.includes(t.id);return(0,s.jsxs)("li",{className:"rounded-xl border p-3 cursor-pointer ".concat(i?"border-emerald-300 bg-emerald-50/60":"border-amber-200 bg-white/70"),onClick:()=>e.push({pathname:"/Read",query:{chapter:t.id,title:a||"Untitled Codex"}}),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"font-serif font-semibold",children:[t.id,". ",t.heading]}),(0,s.jsx)("div",{className:"text-xs text-amber-900/70",children:i?"engraved":"tap to generate"})]}),t.synopsis&&(0,s.jsx)("div",{className:"text-sm text-amber-900/80",children:t.synopsis})]},t.id)})}),!k&&!U&&0===I.length&&(0,s.jsxs)("div",{className:"text-amber-900/80",children:[(0,s.jsx)("div",{children:"No chapters detected. The model may have declined or produced non-TOC text."}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("button",{onClick:()=>M(e=>e+1),className:"rounded-lg bg-amber-600 text-white px-3 py-1 text-xs",children:"Retry seeding"})})]})]}),(0,s.jsx)("div",{className:"mt-4 flex justify-end gap-2",children:I.length>0&&T.length>=I.length&&(0,s.jsx)("button",{onClick:()=>e.push("/Read?export=1"),className:"inline-flex items-center justify-center rounded-xl bg-amber-600 text-white px-5 py-3 shadow hover:bg-amber-700",disabled:k,children:"Export Full Book"})})]})]})})]})}}},function(e){e.O(0,[295,891,916,888,774,179],function(){return e(e.s=4349)}),_N_E=e.O()}]);