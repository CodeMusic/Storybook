(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[162],{2818:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Storyforge",function(){return t(9114)}])},9114:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return U}});var s=t(5893),l=t(7294),r=t(1163),n=t(1891),i=t(1134);let c=(0,i.Z)("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);var o=t(7326);let d=e=>{let{variant:a="primary",className:t="",...l}=e;return(0,s.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm font-medium transition-colors disabled:opacity-60 disabled:pointer-events-none"," ").concat({primary:"bg-amber-600 text-white hover:bg-amber-700",secondary:"bg-amber-100 text-amber-900 hover:bg-amber-200",ghost:"bg-transparent hover:bg-amber-100 text-amber-900"}[a]," ").concat(t),...l})};var m=t(9346);let h=e=>{let{className:a="",...t}=e;return(0,s.jsx)("input",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400 ".concat(a),...t})},p=e=>{let{className:a="",...t}=e;return(0,s.jsx)("textarea",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400 ".concat(a),...t})},x=(0,i.Z)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),g=(0,i.Z)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),u=(0,i.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),y=(0,i.Z)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);function b(e){let{state:a,actions:t}=e,{title:l,premise:r,ageRange:n,genre:i,chapters:c,keypoints:o,style:b,loading:f,status:v,error:j,baseLabel:N}=a,{setTitle:w,setPremise:k,setAgeRange:S,setGenre:C,setChapters:R,setKeypoints:U,setStyle:M,onSeed:E,onPrime:O}=t;return(0,s.jsxs)(m.Zb,{className:"relative backdrop-blur bg-amber-100/70 border-amber-300 shadow-xl rounded-2xl",children:[(0,s.jsxs)(m.Ol,{className:"flex justify-between",children:[(0,s.jsxs)(m.ll,{className:"flex items-center gap-2 text-amber-950",children:[(0,s.jsx)(x,{className:"h-5 w-5"})," Seed the Story Codex"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-amber-800/70",children:[(0,s.jsx)(g,{className:"h-4 w-4"})," Endpoint base: ",(0,s.jsx)("span",{className:"font-mono",children:N}),O&&(0,s.jsx)(d,{variant:"secondary",onClick:O,disabled:f,className:"ml-2 h-6 px-2 py-1 text-xs",children:"Retry seed info"})]})]}),(0,s.jsxs)(m.aY,{className:"grid grid-cols-1 md:grid-cols-5 gap-4 ".concat(f?"opacity-60":""),children:[(0,s.jsxs)("div",{className:"md:col-span-3 space-y-3",children:[(0,s.jsx)(h,{placeholder:"Title (optional)",value:l,onChange:e=>w(e.target.value)}),(0,s.jsx)(p,{placeholder:"Whisper your premise…",value:r,onChange:e=>k(e.target.value),rows:5})]}),(0,s.jsxs)("div",{className:"md:col-span-2 grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Age Range"}),(0,s.jsxs)("select",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400",value:n,onChange:e=>S(e.target.value),children:[(0,s.jsx)("option",{value:"1-3",children:"1–3"}),(0,s.jsx)("option",{value:"4-8",children:"4–8"}),(0,s.jsx)("option",{value:"9-15",children:"9–15"}),(0,s.jsx)("option",{value:"16-20",children:"16–20"}),(0,s.jsx)("option",{value:"21-25",children:"21-25"}),(0,s.jsx)("option",{value:"25+",children:"25+"})]})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Genre"}),(0,s.jsxs)("select",{className:"w-full rounded-lg border border-amber-300 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-400",value:i,onChange:e=>C(e.target.value),children:[(0,s.jsx)("option",{value:"fantasy",children:"Fantasy"}),(0,s.jsx)("option",{value:"adventure",children:"Adventure"}),(0,s.jsx)("option",{value:"mystery",children:"Mystery"}),(0,s.jsx)("option",{value:"sci-fi",children:"Sci‑Fi"}),(0,s.jsx)("option",{value:"fairy-tale",children:"Fairy Tale"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"How many chapters?"}),(0,s.jsx)(h,{type:"number",min:3,max:20,value:c,onChange:e=>R(parseInt(e.target.value||"8"))})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Key points (optional)"}),(0,s.jsx)(p,{placeholder:"e.g., Chapter 2: the lantern goes out; Chapter 5: the map is mirrored",value:o,onChange:e=>U(e.target.value),rows:3})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"text-xs uppercase tracking-wide text-amber-900/70",children:"Style Tags"}),(0,s.jsx)(h,{value:b,onChange:e=>M(e.target.value)})]}),(0,s.jsx)("div",{className:"flex items-end gap-2 col-span-2",children:(0,s.jsxs)(d,{onClick:E,disabled:f,className:"flex-1",children:[f?(0,s.jsx)(u,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(y,{className:"mr-2 h-4 w-4"}),"Build Outline"]})}),j&&(0,s.jsx)("div",{className:"col-span-2 rounded-xl border border-red-300 bg-red-50 p-3 text-red-800",children:j})]})]}),f&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-2xl bg-amber-100/60 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"flex items-center gap-3 text-amber-900",children:[(0,s.jsxs)("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),(0,s.jsx)("span",{children:v||"Working… please wait"})]})})]})}let f=(0,i.Z)("StepBack",[["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["polygon",{points:"14,20 4,12 14,4",key:"ypakod"}]]),v=(0,i.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),j=(0,i.Z)("StepForward",[["line",{x1:"6",x2:"6",y1:"4",y2:"20",key:"fy8qot"}],["polygon",{points:"10,4 20,12 10,20",key:"1mc1pf"}]]),N=(0,i.Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function w(e){let{outline:a,chapters:t,scenes:l,influence:r,setInfluence:n,onNext:i,onExport:c,onPrev:o,onSceneImageBroken:h}=e,p=l.length>=t.length;return(0,s.jsxs)(m.Zb,{className:"bg-amber-50/80 border-amber-300",children:[(0,s.jsxs)(m.Ol,{className:"flex justify-between",children:[(0,s.jsx)(m.ll,{className:"text-amber-950",children:"Engraving the Chapters"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[!p&&l.length>0&&(0,s.jsxs)(d,{variant:"secondary",onClick:o,children:[(0,s.jsx)(f,{className:"mr-2 h-4 w-4"})," Back"]}),p?(0,s.jsxs)(d,{onClick:c,children:[(0,s.jsx)(v,{className:"mr-2 h-4 w-4"})," Export Book"]}):(0,s.jsxs)(d,{onClick:i,children:[(0,s.jsx)(j,{className:"mr-2 h-4 w-4"})," Read Next Chapter"]})]})]}),(0,s.jsxs)(m.aY,{className:"space-y-6",children:[(0,s.jsx)("ol",{className:"space-y-2",children:t.map((e,a)=>{let t=a<l.length,r=a===l.length&&!p;return(0,s.jsxs)("li",{className:"rounded-xl border p-3 ".concat(t?"border-emerald-300 bg-emerald-50/60":"border-amber-200 bg-white/60"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"font-serif font-semibold",children:[e.id,". ",e.heading]}),(0,s.jsx)("div",{className:"text-xs flex items-center gap-1",children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N,{className:"h-4 w-4 text-emerald-600"})," Engraved"]}):r?(0,s.jsx)(s.Fragment,{children:"…etching"}):(0,s.jsx)(s.Fragment,{children:"pending"})})]}),e.synopsis&&(0,s.jsx)("div",{className:"text-sm text-amber-900/80",children:e.synopsis})]},e.id)})}),l.length>0&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"text-amber-900/70 uppercase text-xs",children:"Story so far"}),l.map((e,a)=>(0,s.jsxs)("div",{className:"rounded-2xl border border-amber-200 bg-white/70 p-4",children:[(0,s.jsxs)("div",{className:"font-serif text-lg mb-2",children:["Chapter ",e.chapterId,": ",e.chapterHeading]}),e.imageUrl&&(0,s.jsx)("img",{src:e.imageUrl,alt:"Scene",className:"w-full h-auto rounded-lg border border-amber-200 mb-3",onError:()=>h&&h(a)}),(0,s.jsx)("div",{className:"prose prose-amber max-w-none",dangerouslySetInnerHTML:{__html:e.html}})]},a))]})]})]})}var k=t(1207),S=t(2743),C=t(8914);let R=()=>(0,s.jsxs)("div",{className:"pointer-events-none fixed inset-0 -z-10",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-amber-50 via-amber-100 to-amber-50"}),(0,s.jsxs)("svg",{className:"absolute inset-0 w-full h-full opacity-20 mix-blend-multiply",children:[(0,s.jsx)("defs",{children:(0,s.jsxs)("pattern",{id:"runes",width:"120",height:"120",patternUnits:"userSpaceOnUse",children:[(0,s.jsx)("text",{x:"8",y:"28",className:"fill-amber-900/50 text-[22px] font-serif",children:"ᚠᚢᚦᚨᚱ"}),(0,s.jsx)("text",{x:"36",y:"70",className:"fill-amber-900/40 text-[18px] font-serif",children:"ᚷᚹᚺᚾᛁ"}),(0,s.jsx)("text",{x:"18",y:"108",className:"fill-amber-900/30 text-[20px] font-serif",children:"ᛃᛇᛈᛉᛋ"})]})}),(0,s.jsx)("rect",{width:"100%",height:"100%",fill:"url(#runes)"})]}),(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-amber-200/40"}),(0,s.jsx)("div",{className:"absolute inset-0 shadow-[inset_0_0_180px_rgba(0,0,0,0.25)]"})]});function U(){var e;let a=(0,r.useRouter)(),t="string"==typeof(null===(e=a.query)||void 0===e?void 0:e.idea)?a.query.idea:"",i="storyforge.session.v1",[m,p]=(0,l.useState)(""),[x,g]=(0,l.useState)(t||""),[u,y]=(0,l.useState)((0,C.R)("6-8")),[f,v]=(0,l.useState)("fantasy"),[j,N]=(0,l.useState)(8),[U,M]=(0,l.useState)(""),[E,O]=(0,l.useState)("warm, whimsical, gentle-humor"),[_,I]=(0,l.useState)(!1),[L,T]=(0,l.useState)(null),[H,Z]=(0,l.useState)(void 0),[A,F]=(0,l.useState)(null),[z,J]=(0,l.useState)([]),[P,B]=(0,l.useState)(null),[q,W]=(0,l.useState)([]),[G,Y]=(0,l.useState)(""),[X,D]=(0,l.useState)(!1);function K(){F(null),J([]),W([])}async function V(){{let e={title:m,premise:x,ageRange:(0,C.R)(u),genre:f,chaptersTarget:j,keypoints:U,style:E,coverUrl:P};try{let a=window.localStorage.getItem(i),t={...a?JSON.parse(a):{},...e,toc:null,chapters:[],scenes:[],seedSignature:void 0};window.localStorage.setItem(i,JSON.stringify(t))}catch(e){}a.push("/Outline?reseed=1")}}async function Q(){try{if(!z.length)return;let e=q.length,a=z[e];I(!0),T(null);let t={title:m||"Untitled Codex",toc:A,priorHtml:q.map(e=>e.html),keypoints:U,genre:f,ageRange:(0,C.R)(u)},{html:s}=await (0,S.Yl)({context:t,chapterIndex:e,influence:G.trim()||void 0}),l=null;try{l=(await (0,S.km)("".concat(m," (ages ").concat((0,C.R)(u),"): ").concat(a.heading,". ").concat(s.slice(0,180),"..."))).url}catch(e){}W(e=>[...e,{chapterId:a.id,chapterHeading:a.heading,html:s,imageUrl:l}]),Y("")}catch(e){T(e.message||"Chapter failed")}finally{I(!1)}}async function $(){try{I(!0),T(null);let e=q.map(e=>{let a=e.imageUrl?'<img src="'.concat(e.imageUrl,'" alt="Scene for Chapter ').concat(e.chapterId,": ").concat(e.chapterHeading,'" style="max-width:100%;height:auto;border:1px solid #e2c084;border-radius:12px;margin:12px 0;"/>'):"";return"".concat(a,"\n").concat(e.html)}),{downloadUrl:a,filename:t}=await (0,S.WF)({htmlPages:e,coverUrl:P,meta:{title:m,toc:A,chapters:z}});if(a){let e=document.createElement("a");e.href=a,e.download=t||"".concat(m||"storybook",".html"),document.body.appendChild(e),e.click(),e.remove(),a.startsWith("blob:")&&URL.revokeObjectURL(a);return}let s=new Blob([JSON.stringify({title:m,toc:A,chapters:z,scenes:q,coverUrl:P},null,2)],{type:"application/json"}),l=URL.createObjectURL(s),r=document.createElement("a");r.href=l,r.download="".concat(m||"storybook",".json"),document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(l)}finally{I(!1)}}(0,l.useEffect)(()=>{try{let e=window.localStorage.getItem(i),a=e?JSON.parse(e):{},s=(null==a?void 0:a.premise)||"";if(t&&t!==s){p(""),g(t),y((0,C.R)(a.ageRange||"6-8")),v(a.genre||"fantasy"),N("number"==typeof a.chaptersTarget?a.chaptersTarget:8),M(a.keypoints||""),O(a.style||"warm, whimsical, gentle-humor"),F(null),J([]),B(a.coverUrl||null),W([]),Y("");try{let e={...a,title:"",premise:t,toc:null,chapters:[],scenes:[],seedSignature:void 0};window.localStorage.setItem(i,JSON.stringify(e))}catch(e){}return}a&&(p(a.title||""),g(t||s||""),y((0,C.R)(a.ageRange||"6-8")),v(a.genre||"fantasy"),N("number"==typeof a.chaptersTarget?a.chaptersTarget:8),M(a.keypoints||""),O(a.style||"warm, whimsical, gentle-humor"),t?(F(null),J([]),W([])):(F(a.toc||null),J(Array.isArray(a.chapters)?a.chapters:[]),W(Array.isArray(a.scenes)?a.scenes:[])),B(a.coverUrl||null),Y(""))}catch(e){}finally{D(!0)}},[t]);let ee=(0,l.useRef)(!1);(0,l.useEffect)(()=>{if(X&&!ee.current)try{let e=JSON.stringify({title:m,premise:x,ageRange:(0,C.R)(u),genre:f,chaptersTarget:j,keypoints:U,style:E}),a=window.localStorage.getItem(i),t=a?JSON.parse(a):{};if((null==t?void 0:t.seedSignature)!==e){ee.current=!0;try{window.localStorage.setItem(i,JSON.stringify({...t,toc:null,chapters:[],scenes:[],seedSignature:void 0,title:m,premise:x,ageRange:(0,C.R)(u),genre:f,chaptersTarget:j,keypoints:U,style:E}))}catch(e){}}}catch(e){}},[X,m,x,u,f,j,U,E,a]),(0,l.useEffect)(()=>{let e={title:m,premise:x,ageRange:(0,C.R)(u),genre:f,chaptersTarget:j,keypoints:U,style:E,toc:A,chapters:z,coverUrl:P,scenes:q};try{window.localStorage.setItem(i,JSON.stringify(e))}catch(e){}},[m,x,u,f,j,U,E,A,z,P,q]),(0,l.useEffect)(()=>{X&&(async()=>{if(t&&!z.length&&!A)try{I(!0),Z("Fetching seed info…");let{info:e}=await (0,S.o9)({prompt:t});if(e){"string"==typeof e?g(e||""):(e.title&&p(e.title),e.description&&g(e.description),e.ageRange&&y((0,C.R)(e.ageRange)),e.genre&&v(e.genre),"number"==typeof e.chapters&&N(e.chapters),e.keypoints&&M(e.keypoints),e.style&&O(e.style));let a=(0,k.Z)(e.title||m||"Untitled Codex",(e.description||x||"").split("\n").slice(0,2).join("\n"));try{Z("Generating cover image…");let e=await (0,S.km)(a);B(e.url)}catch(e){}}}catch(e){T(e.message||"Prime failed")}finally{I(!1),Z(void 0)}})()},[t,X]);let ea=async()=>{try{let e=(0,k.Z)(m||"Untitled Codex",(x||"").split("\n").slice(0,2).join("\n"));Z("Regenerating cover image…");let a=await (0,S.km)(e);B(a.url)}catch(e){}finally{Z(void 0)}},et=async e=>{try{let a=q[e];if(!a)return;let t="".concat(m," (ages ").concat((0,C.R)(u),"): Chapter ").concat(a.chapterId," - ").concat(a.chapterHeading,". ").concat(a.html.replace(/<[^>]+>/g," ").slice(0,180),"..."),s=await (0,S.km)(t);W(a=>a.map((a,t)=>t===e?{...a,imageUrl:s.url}:a))}catch(a){W(a=>a.map((a,t)=>t===e?{...a,imageUrl:null}:a))}};return(0,s.jsxs)("div",{className:"min-h-screen text-amber-950",children:[(0,s.jsx)(R,{}),(0,s.jsx)("header",{className:"relative",children:(0,s.jsxs)("div",{className:"mx-auto max-w-6xl px-4 py-10",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(n.E.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-2xl bg-amber-200/70 p-2 shadow",children:(0,s.jsx)(c,{className:"h-6 w-6"})}),(0,s.jsx)(n.E.h1,{initial:{opacity:0,y:0},animate:{opacity:1,y:0},className:"text-3xl md:text-4xl font-serif tracking-wide",children:"The Storyforge Terminal"})]}),(0,s.jsxs)("p",{className:"mt-2 max-w-2xl text-amber-900/80",children:["This site ",(0,s.jsx)("em",{children:"is"})," the relic. Seed a tale, step through each engraved chapter, and watch the images appear."]})]})}),(0,s.jsxs)("main",{className:"relative mx-auto max-w-6xl px-4 pb-28",children:[(0,s.jsxs)("div",{className:"mt-0 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsx)(b,{state:{title:m,premise:x,ageRange:u,genre:f,chapters:j,keypoints:U,style:E,loading:_,status:H,error:L,baseLabel:S.tH.replace("https://","")},actions:{setTitle:function(e){p(e),K()},setPremise:function(e){g(e),K()},setAgeRange:y,setGenre:v,setChapters:N,setKeypoints:M,setStyle:O,onSeed:V,onPrime:async()=>{try{I(!0),Z("Fetching seed info…"),T(null);let{info:e}=await (0,S.o9)({prompt:t||x});if(e){(e.title&&e.title!==m||e.description&&e.description!==x)&&K(),e.title&&p(e.title),e.description&&g(e.description),e.ageRange&&y((0,C.R)(e.ageRange)),e.genre&&v(e.genre),"number"==typeof e.chapters&&N(e.chapters),e.keypoints&&M(e.keypoints),e.style&&O(e.style);let a=(0,k.Z)(e.title||m||"Untitled Codex",(e.description||x||"").split("\n").slice(0,2).join("\n"));try{Z("Generating cover image…");let e=await (0,S.km)(a);B(e.url)}catch(e){}}}catch(e){T(e.message||"Prime failed")}finally{I(!1),Z(void 0)}}}})}),(0,s.jsx)("div",{children:(0,s.jsx)(o.T,{coverUrl:P,title:m||"Untitled Codex",onBroken:ea})})]}),z.length>0&&(0,s.jsx)("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6",children:(0,s.jsx)("div",{className:"lg:col-span-3",children:(0,s.jsx)(w,{outline:{title:m,toc:A},chapters:z,scenes:q,influence:G,setInfluence:Y,onNext:Q,onExport:$,onPrev:function(){0!==q.length&&W(e=>e.slice(0,e.length-1))},onSceneImageBroken:et})})}),z.length>0&&q.length<z.length&&(0,s.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-20",children:(0,s.jsx)("div",{className:"mx-auto max-w-6xl px-4 pb-4",children:(0,s.jsxs)("div",{className:"rounded-2xl border border-amber-300 bg-amber-50/80 backdrop-blur px-3 py-3 shadow-lg",children:[(0,s.jsx)("div",{className:"text-xs uppercase text-amber-900/60 mb-2",children:"Influence the next step"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(h,{value:G,onChange:e=>Y(e.target.value),placeholder:"A subtle hint (e.g., ‘lanterns sway in a 7/8 rhythm’)"}),(0,s.jsx)(d,{onClick:Q,disabled:_,children:"Apply & Continue"})]})]})})})]})]})}}},function(e){e.O(0,[295,891,127,888,774,179],function(){return e(e.s=2818)}),_N_E=e.O()}]);