"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[916],{7326:function(t,e,n){n.d(e,{T:function(){return a}});var r=n(5893);n(7294);var o=n(9346);function a(t){let{coverUrl:e,title:n}=t;return(0,r.jsxs)(o.Zb,{className:"bg-amber-50/80 border-amber-300 overflow-hidden",children:[e&&(0,r.jsx)("img",{src:e,alt:"Cover",className:"w-full aspect-[4/3] object-cover"}),(0,r.jsx)(o.Ol,{children:(0,r.jsx)(o.ll,{className:"text-amber-950",children:"Codex Core"})}),(0,r.jsxs)(o.aY,{className:"text-sm",children:[(0,r.jsx)("div",{className:"text-amber-900/70 uppercase text-xs",children:"Title"}),(0,r.jsx)("div",{className:"font-serif text-lg",children:n})]})]})}},9346:function(t,e,n){n.d(e,{Ol:function(){return a},Zb:function(){return o},aY:function(){return c},ll:function(){return i}});var r=n(5893);n(7294);let o=t=>{let{className:e="",...n}=t;return(0,r.jsx)("div",{className:"rounded-2xl border bg-white ".concat(e),...n})},a=t=>{let{className:e="",...n}=t;return(0,r.jsx)("div",{className:"px-4 py-3 border-b ".concat(e),...n})},i=t=>{let{className:e="",...n}=t;return(0,r.jsx)("div",{className:"text-lg font-semibold ".concat(e),...n})},c=t=>{let{className:e="",...n}=t;return(0,r.jsx)("div",{className:"px-4 py-3 ".concat(e),...n})}},1207:function(t,e,n){function r(t){let e=t.replace(/```[\s\S]*?```/g,"").replace(/\*\*(.*?)\*\*/g,"$1").split(/\r?\n/).map(t=>t.trim()).filter(Boolean),n=[],r=1;function o(t,e){let o=t.replace(/^#{1,6}\s+/,"").trim(),a=(o=o.replace(/^(?:Chapter|Ch\.?|C)\s*\d+\s*[:.\-]\s*/i,"").trim())||"Chapter ".concat(r),i=(e||"").trim()||void 0;n.push({id:r++,heading:a,synopsis:i})}for(let t=0;t<e.length;t++){let n=e[t],r=n.match(/^\s*(?:\d+[\).]|[•\-*]|\d+\s+)\s*(.*)$/);if(r){let t=r[1].trim().split(/[—–\-:]\s+/);o((t[0]||"").replace(/^(?:Chapter|Ch\.?|C)\s*\d+\s*[:.\-]\s*/i,"").trim(),(t.slice(1).join(" - ")||"").trim());continue}let a=n.match(/^#{1,6}\s+(.*)$/);if(a){if(/table of contents/i.test(a[1]))continue;let n=e[t+1],r=n&&!/^#{1,6}\s+/.test(n)&&!/^\s*(?:\d+[\).]|[•\-*])\s+/.test(n);o(a[1],r?n:void 0),r&&t++;continue}let i=n.match(/^(?:Chapter|Ch\.?|C)\s*\d+\s*[:.\-]\s*(.*)$/i);if(i){let n=e[t+1],r=n&&!/^(?:Chapter|Ch\.?|C)\s*\d+\s*[:.\-]\s*/i.test(n)&&!/^#{1,6}\s+/.test(n)&&!/^\s*(?:\d+[\).]|[•\-*])\s+/.test(n);o(i[1],r?n:void 0),r&&t++;continue}}return n}function o(t,e){let n=e.split(/\r?\n/).filter(Boolean).slice(0,2).join(", ");return"".concat(t,": ").concat(n,". Cozy watercolor, soft light, storybook composition, ancient relic/tech motif.")}n.d(e,{B:function(){return r},Z:function(){return o}})},2743:function(t,e,n){n.d(e,{Mq:function(){return m},WF:function(){return b},Yl:function(){return h},bV:function(){return s},km:function(){return g},o9:function(){return x},tH:function(){return a}});var r=n(4406),o=n(8834).lW;let a="https://n8n.codemusic.ca/webhook",i=r.env.NEXT_PUBLIC_N8N_USER||"siteuser",c=r.env.NEXT_PUBLIC_N8N_PASS||"codemusai",s={prime:"".concat(a,"/seedInfo"),seed:"".concat(a,"/seedStory"),chapter:"".concat(a,"/expandChapter"),image:"".concat(a,"/genImage"),export:"".concat(a,"/exportBook")};function l(){let t="".concat(i,":").concat(c);try{let e="function"==typeof btoa?btoa(t):o.from(t).toString("base64");return"Basic ".concat(e)}catch(t){return""}}function u(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e5,r=new AbortController,o=setTimeout(()=>r.abort(),n);return fetch(t,{...e,signal:r.signal}).finally(()=>clearTimeout(o))}async function p(t,e){let n=await u(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l()},body:JSON.stringify(e)}),r=await n.text();if(!n.ok)throw Error(r||"Endpoint error ".concat(n.status));if(!r)throw Error("Empty response");return r}async function d(t,e){let n=await u(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l()},body:JSON.stringify(e)}),r=await n.text();if(!n.ok)throw Error(r||"Endpoint error ".concat(n.status));try{return JSON.parse(r)}catch(t){throw Error("Invalid JSON response")}}async function f(t,e){let n=await u(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l()},body:JSON.stringify(e)}),r=await n.text();if(!n.ok)throw Error(r||"Endpoint error ".concat(n.status));return r}async function m(t){console.log("DEBUG seedStory: endpoint =",s.seed),console.log("DEBUG seedStory: payload =",t);try{let e=await p(s.seed,t);console.log("DEBUG seedStory: raw response =",e);let n=function(t){let e=(t||"").toString().trim();if(!e)return e;try{let t=JSON.parse(e);if(Array.isArray(t)&&t.length>0){let e=t[0];if("string"==typeof(null==e?void 0:e.toc))return e.toc;if("string"==typeof(null==e?void 0:e.output))return e.output}if("object"==typeof t&&t){if("string"==typeof t.toc)return t.toc;if("string"==typeof t.output)return t.output}}catch(t){}return e}(e);return console.log("DEBUG seedStory: parsed toc =",n),{toc:n}}catch(t){throw console.error("DEBUG seedStory: error =",t),t}}async function h(t){return{html:function t(e){let n=(e||"").toString().trim();if(!n)return"";try{let e=JSON.parse(n);if(Array.isArray(e)&&e.length>0){let n=e[0];if("string"==typeof(null==n?void 0:n.html))return n.html;if("string"==typeof(null==n?void 0:n.output))return t(n.output)}if("object"==typeof e&&e){if("string"==typeof e.html)return e.html;if("string"==typeof e.output)return t(e.output)}}catch(t){}return/[<][a-zA-Z!/?]/.test(n)?n:n.split(/\n{2,}/).map(t=>t.trim()).filter(Boolean).map(t=>{let e=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br/>");return"<p>".concat(e,"</p>")}).join("\n")}(await p(s.chapter,t))}}async function y(t,e){let n=await u(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l()},body:JSON.stringify(e)}),r=n.headers.get("content-type")||"";if(!n.ok)throw Error(await n.text().catch(()=>"")||"Endpoint error ".concat(n.status));if(r.startsWith("image/")){let t=await n.blob();return URL.createObjectURL(t)}let o=await n.text();try{let t=JSON.parse(o);if("string"==typeof(null==t?void 0:t.url))return t.url;if("string"==typeof(null==t?void 0:t.data)){let e=(null==t?void 0:t.mime)||(null==t?void 0:t.type)||"image/png";if(t.data.startsWith("data:"))return t.data;return"data:".concat(e,";base64,").concat(t.data)}}catch(t){}let a=o.trim();if(!a)throw Error("Empty response");return a}async function g(t){return{url:await y(s.image,{prompt:t})}}async function b(t){try{var e;let{htmlPages:n,coverUrl:r,meta:o}=t||{},a=((null==o?void 0:o.title)||"Untitled Codex").toString(),i=a.replace(/[^a-z0-9\- _\(\)\[\]]+/gi,"_").trim()||"storybook",c=Array.isArray(n)?n.join("\n\n<hr/>\n\n"):"",s="string"==typeof(null==o?void 0:o.toc)&&o.toc.trim()?'<pre style="white-space:pre-wrap;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:#fff7ed;border:1px solid #fed7aa;border-radius:8px;padding:12px;">'.concat(o.toc,"</pre>"):"",l='<!doctype html>\n<html lang="en">\n<head>\n  <meta charset="utf-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1" />\n  <title>'.concat(a,'</title>\n  <style>\n    body { color:#451a03; background:#fffbeb; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji"; margin: 24px; }\n    h1, h2, h3 { font-family: ui-serif, Georgia, Cambria, "Times New Roman", Times, serif; color:#7c2d12; }\n    .container { max-width: 780px; margin: 0 auto; }\n    .card { background: rgba(255, 237, 213, 0.6); border: 1px solid #fdba74; border-radius: 16px; padding: 16px; }\n    .meta { color:#92400e; font-size: 0.9rem; }\n    hr { border:0; border-top:1px solid #fed7aa; margin: 24px 0; }\n    .chapter { margin: 16px 0; }\n    .chapter img { max-width:100%; height:auto; border-radius: 8px; border:1px solid #fcd34d; }\n    .prose p { line-height: 1.7; margin: 10px 0; }\n  </style>\n  <meta name="generator" content="Storyforge" />\n  <meta name="description" content="Exported Storyforge book" />\n  <meta name="author" content="Storyforge" />\n  <meta name="storyforge:title" content="').concat(a,'" />\n  <meta name="storyforge:chapters" content="').concat(((null==o?void 0:null===(e=o.chapters)||void 0===e?void 0:e.length)||0).toString(),'" />\n  <script>/* Standalone export generated locally without server dependency */</script>\n  <link rel="icon" href="data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 16 16\'><text y=\'14\' font-size=\'14\'>\uD83D\uDCDC</text></svg>">\n  <meta name="color-scheme" content="light" />\n  <meta name="theme-color" content="#f59e0b" />\n  <meta name="apple-mobile-web-app-capable" content="yes" />\n  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />\n  <meta name="apple-mobile-web-app-title" content="').concat(a,'" />\n  <meta name="format-detection" content="telephone=no" />\n  <meta name="mobile-web-app-capable" content="yes" />\n</head>\n<body>\n  <main class="container">\n    <div class="card">\n      <h1>').concat(a,"</h1>\n      ").concat(r?'<img src="'.concat(r,'" alt="Cover" style="max-width:100%;height:auto;border:1px solid #e2c084;border-radius:12px;margin:12px 0;"/>'):"","\n      ").concat(s,'\n    </div>\n    <section class="prose chapter">').concat(c,"</section>\n  </main>\n</body>\n</html>"),u=new Blob([l],{type:"text/html;charset=utf-8"});return{downloadUrl:URL.createObjectURL(u),filename:"".concat(i,".html")}}catch(e){try{return{downloadUrl:await p(s.export,t)}}catch(t){return{downloadUrl:null}}}}async function x(t){try{let e=await d(s.prime,t),n=t=>{let e=(t||"").trim(),n=e.match(/```\s*json\s*([\s\S]*?)```/i)||e.match(/```\s*([\s\S]*?)```/i),r=(n?n[1]:e).trim();r=r.replace(/^\s*\(\s*/,"").replace(/\s*\)\s*$/,"");try{let t=JSON.parse(r);if(t&&"object"==typeof t){let e={title:t.title,description:t.description,ageRange:t.ageRange,genre:t.genre,chapters:t.chapters,keypoints:t.keypoints,style:t.style};if(Object.values(e).some(t=>null!=t&&""!==t))return e}}catch(t){}let o=e.split(/\r?\n/).filter(Boolean);return o.length>=3&&o.slice(0,3).every(t=>/^(\s*(\d+[\).]|[•\-*])\s*)?/.test(t))?{toc:e}:{description:e}};if(Array.isArray(e)&&e.length>0){let t=e[0];if("string"==typeof(null==t?void 0:t.output))return{info:n(t.output)};if(t&&"object"==typeof t)return{info:t}}if("string"==typeof(null==e?void 0:e.output))return{info:n(e.output)};return{info:e}}catch(e){try{let e=(await f(s.prime,t)||"").toString().trim();return{info:e?{description:e}:{}}}catch(t){throw t}}}}}]);